!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.simplescreenshot=t():e.SimpleScreenshot=t()}(window,(function(){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}({3:function(e,t,i){var o,r,a;r=[],void 0===(a="function"==typeof(o=function(){let e=/url\(['"]?([^'"]+?)['"]?\)/g,t=[],i=[];const o=["background-attachment","background-blend-mode","background-clip","-webkit-background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","bottom","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","content","cursor","direction","display","empty-cells","float","font-family","font-kerning","font-optical-sizing","font-size","font-stretch","font-style","font-variant","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-weight","image-rendering","isolation","justify-items","justify-self","left","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","margin-bottom","margin-left","margin-right","margin-top","max-height","max-width","min-height","min-width","mix-blend-mode","object-fit","object-position","offset-distance","offset-path","offset-rotate","opacity","orphans","outline-color","outline-offset","outline-style","outline-width","overflow-anchor","overflow-wrap","overflow-x","overflow-y","padding-bottom","padding-left","padding-right","padding-top","pointer-events","position","resize","right","scroll-behavior","speak","table-layout","tab-size","text-align","text-align-last","text-decoration","text-decoration-line","text-decoration-style","text-decoration-color","text-decoration-skip-ink","text-underline-position","text-indent","text-rendering","text-shadow","text-size-adjust","text-overflow","text-transform","top","touch-action","unicode-bidi","vertical-align","visibility","white-space","widows","will-change","word-break","word-spacing","z-index","zoom","-webkit-appearance","backface-visibility","-webkit-border-horizontal-spacing","-webkit-border-image","-webkit-border-vertical-spacing","-webkit-box-align","-webkit-box-decoration-break","-webkit-box-direction","-webkit-box-flex","-webkit-box-ordinal-group","-webkit-box-orient","-webkit-box-pack","-webkit-box-reflect","column-count","column-gap","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","backdrop-filter","align-content","align-items","align-self","flex-basis","flex-grow","flex-shrink","flex-direction","flex-wrap","justify-content","-webkit-font-smoothing","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column-end","grid-column-start","grid-template-areas","grid-template-columns","grid-template-rows","grid-row-end","grid-row-start","row-gap","-webkit-highlight","hyphens","-webkit-hyphenate-character","-webkit-line-break","-webkit-line-clamp","-webkit-locale","-webkit-margin-before-collapse","-webkit-margin-after-collapse","-webkit-mask-box-image","-webkit-mask-box-image-outset","-webkit-mask-box-image-repeat","-webkit-mask-box-image-slice","-webkit-mask-box-image-source","-webkit-mask-box-image-width","-webkit-mask-clip","-webkit-mask-composite","-webkit-mask-image","-webkit-mask-origin","-webkit-mask-position","-webkit-mask-repeat","-webkit-mask-size","order","perspective","perspective-origin","-webkit-print-color-adjust","-webkit-rtl-ordering","shape-outside","shape-image-threshold","shape-margin","-webkit-tap-highlight-color","-webkit-text-combine","-webkit-text-decorations-in-effect","-webkit-text-emphasis-color","-webkit-text-emphasis-position","-webkit-text-emphasis-style","-webkit-text-fill-color","-webkit-text-orientation","-webkit-text-security","-webkit-text-stroke-color","-webkit-text-stroke-width","transform","transform-origin","transform-style","-webkit-user-drag","-webkit-user-modify","user-select","-webkit-writing-mode","-webkit-app-region","buffered-rendering","clip-path","clip-rule","mask","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","marker-end","marker-mid","marker-start","mask-type","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","alignment-baseline","baseline-shift","dominant-baseline","text-anchor","writing-mode","vector-effect","paint-order","d","cx","cy","x","y","r","rx","ry","caret-color","line-break"];function r(e){this.devicePixelRatio=e.devicePixelRatio||1,this.error=e.error||function(){},this.log=e.log||console.log,this.puppeteerServer=e.puppeteerServer,this.puppeteerGlobalFont=e.puppeteerGlobalFont,this.pupServerCanModifyFont=!e.pupServerCanModifyFont||e.pupServerCanModifyFont,this.imgType=e.imgType||"jpeg",this.imgQuality=parseInt(e.imgQuality)||80,this.distWidth=e.distWidth,this.distHeight=e.distHeight,this.debug=!!e.debug,this.textDecode=e.textDecode?e.textDecode:function(e){return e},this.supportForeignObject=!1,this.forceScreenshotType="server",this._isLoading=!1,this._wholeTexts="",this.fontList=[];let o=e.fontList||[];for(let e=0;e<o.length;e++)this.fontList.push({name:o[e],texts:""});this.globalInlineFont=e.globalInlineFont||"",this.preLoadResource=e.preLoadResource||[];for(let e=0;e<this.preLoadResource.length;e++){let o=this.preLoadResource[e].name,r=this.preLoadResource[e].data;r&&""!=r&&(t.push(o),i.push(r))}this.parentCSS=e.parentCSS||[{name:"opacity",value:1},{name:"transform",value:""},{name:"filter",value:""}],this.parseCSSFilter=e.parseCSSFilter||[],this.rules={autoRenderWidth:!1}}return r.prototype.toSVG=function(e,t){let i=this;i._wholeTexts="",wx.createSelectorQuery().selectAll(e).fields({dataset:!0,size:!0,computedStyle:o},(function(e){i.nodes=e,i.parseCSSRules((function(){i.root=i.getNodeByLevel("0");let e=parseFloat(i.root.width)*i.devicePixelRatio,o=parseFloat(i.root.height)*i.devicePixelRatio,r=i.toHTML(i.root,!0),a="";a+="<svg xmlns='http://www.w3.org/2000/svg'",a+=" width='"+e+"'",a+=" height='"+o+"'",a+=">",a+="<foreignObject width='100%' height='100%'>",a+="<div xmlns='http://www.w3.org/1999/xhtml' style='","inline-block"==i.root.display&&(a+="font-size : 0 ;");for(let e=0;e<i.parentCSS.length;e++){let t=i.parentCSS[e];t.value=null==t.value?"":(t.value+"").trim(),"transform"==t.name&&(t.value+=" scale("+i.devicePixelRatio+")"),""!=t.value&&(a+=t.name+" : "+t.value+" ;")}a+="transform-origin:0 0;'>",a+=r,a+="</div>",a+="</foreignObject>",a+="</svg>",t({svg:a,width:i.root.width,height:i.root.height,fonts:i.fontList,devicePixelRatio:i.devicePixelRatio,distWidth:i.distWidth?i.distWidth:i.root.width*i.devicePixelRatio,distHeight:i.distHeight?i.distHeight:i.root.height*i.devicePixelRatio,imgType:i.imgType,imgQuality:i.imgQuality})}))})).exec()},r.prototype.toIMG=function(e,t){let i=this;i.toSVG(e,(function(e){i.puppeteerGlobalFont&&(i.pupServerCanModifyFont||i.fontList.push({name:i.puppeteerGlobalFont,texts:i._wholeTexts}),e.globalFont=i.puppeteerGlobalFont),i.debug&&i.log(e),wx.request({url:i.puppeteerServer,method:"post",data:e,success(e){t({canvas:null,base64:e.data})},fail(e){i.error(e)}})}))},r.prototype.toHTML=function(e,o){let r=this,a="",n="",s=this.getNodeName(e.dataset.name),l=this.parseCSS(e,o),d=e.dataset.level,c=e.dataset.len,p=[];try{null!=e.dataset.texts&&(p=JSON.parse(e.dataset.texts.replace(/'/g,'"')));for(let e=0;e<p.length;e++)p[e].text=this.textDecode(p[e].text).replace(/&/g,"&amp;")}catch(t){r.debug&&r.log({msg:e.dataset.texts+" json parse error",err:t})}for(let t=0;t<c;t++){let i=d+"-"+t,o=!1;for(let t=0;t<p.length;t++)if(i==p[t].level){let i=e["font-family"];for(let e=0;e<this.fontList.length;e++){let o=this.fontList[e];if(i.includes(o.name))for(let e=0;e<p[t].text.length;e++)o.texts.includes(p[t].text[e])||(o.texts+=p[t].text[e])}for(let e=0;e<p[t].text.length;e++)this._wholeTexts.includes(p[t].text[e])||(this._wholeTexts+=p[t].text[e]);n+=p[t].text,o=!0}if(!o){let e=this.getNodeByLevel(d+"-"+t);e&&(n+=this.toHTML(e,!1))}}if(a+="<"+s+" xmlns='http://www.w3.org/1999/xhtml'",e.dataset.src){var g=t.indexOf(e.dataset.src);a+=-1!=g?" src='"+i[g]+"'":" src='"+e.dataset.src+"'"}return o?(a+=" id='simple-screenshot'>",a+="<style>",a+="#simple-screenshot,#simple-screenshot *:not(style){"+l+"} "+this.globalInlineFont,a+="</style>"):a+=" style='"+l+"'>",a+=n,a+="</"+s+">",a},r.prototype.parseCSS=function(r,a){let n="";r._rules={autoRenderWidth:this.rules.autoRenderWidth};for(let e=0;e<this.parseCSSFilter.length;e++){let t=this.parseCSSFilter[e];(s=t)&&"[object Function]"==={}.toString.call(s)&&t(r)}var s;let l=null;for(let s=0;s<o.length;s++){let p=o[s];if(a)["margin-top","margin-left","margin-bottom","margin-right"].includes(p)?r[p]=0:"absolute"!=r.position&&"fixed"!=r.position||!["top","bottom","left","right"].includes(p)||(r[p]=0);else if(r[p]==this.root[p])continue;if("background-image"==p){let o=!1;if(e.lastIndex=0,l=e.exec(r[p]),null!=l){var d=l[1];if(r[p]&&d&&-1==d.search(/^(data:)/)){var c=t.indexOf(d);o=!0,n+=-1!=c?p+": url("+i[c]+");":p+": url("+encodeURIComponent(d)+");"}}o||(n+=p+":"+r[p]+";")}else n+=p+":"+r[p]+";"}let p=r.width,g=r.height,h=parseFloat(r["border-bottom-width"]),u=parseFloat(r["border-top-width"]),f=parseFloat(r["border-left-width"]),b=parseFloat(r["border-right-width"]);if(f=f>=0?f:0,b=b>=0?b:0,u=u>=0?u:0,h=h>=0?h:0,p-=f+b,g-=u+h,"border-box"!=r["box-sizing"]){let e=parseFloat(r["padding-top"]),t=parseFloat(r["padding-left"]),i=parseFloat(r["padding-bottom"]),o=parseFloat(r["padding-right"]);e=e>=0?e:0,t=t>=0?t:0,i=i>=0?i:0,o=o>=0?o:0,p-=t+o,g-=e+i}return r._rules.autoRenderWidth&&!a?n+="width: auto;":n+="width:"+p+"px;",n+="height:"+g+"px;",n},r.prototype.getNodeByLevel=function(e){for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].dataset.level==e)return this.nodes[t];return null},r.prototype.parseCSSRules=function(e){let t=0,i=this;i._isLoading=!1;let o=function(){i._isLoading=!0,t++},r=function(){t--,0==t&&(i._isLoading=!0,e())};for(let e=0;e<this.nodes.length;e++){let t=this.nodes[e];if("image"!=t.dataset.name||!t.dataset.canvasid||""!=t.dataset.src&&t.dataset.src){t.src&&t.src.length>0&&this.loadResource("url("+t.src+")",o,r),t.dataset.src&&t.dataset.src.length>0&&this.loadResource("url("+t.dataset.src+")",o,r);let e=t["background-image"];e&&e.length>0&&"none"!=e&&this.loadResource(t["background-image"],o,r)}else!function(e){let t=e.dataset.canvaswidth,a=e.dataset.canvasheight,n=e.dataset.canvasid;o(),wx.canvasToTempFilePath({width:t,height:a,destWidth:t,destHeight:a,canvasId:n,success(t){try{let i=qq.getFileSystemManager().readFileSync(t.tempFilePath,"base64");e.dataset.src="data:image/png;base64,"+i,r()}catch(e){i.error({msg:"canvas to base64 error",err:e})}},fail(e){i.error({msg:"canvas to tempfilepath fail",err:e})}})}(t)}i._isLoading||e()},r.prototype.loadResource=function(o,r,a){e.lastIndex=0;let n=e.exec(o),s=this;if(null!=n){let e=n[1];if(o&&e&&-1==e.search(/^(data:)/)&&!t.includes(e)){let o=this.getType(e);null!=o&&(t.push(e),r(),wx.request({url:e,method:"GET",responseType:"arraybuffer",success:function(r){try{let n=wx.arrayBufferToBase64(r.data),s=t.indexOf(e);i[s]="data:"+o+";base64,"+n,a()}catch(t){s.error({msg:e+" to base64 error",err:t})}},fail:function(t){s.error({msg:e+" request fail",err:t})}}))}}},r.prototype.getNodeName=function(e){let t="div";switch(e){case"image":t="img"}return t},r.prototype.getType=function(e){let t=[".png",".jpg",".jpeg"],i=["image/png","image/jpg","image/jpg"];for(let o=0;o<t.length;o++)if(e.lastIndexOf(t[o])+t[o].length==e.length)return i[o];return i[0]},r.prototype.clearResourceCache=function(){t=[],i=[]},r})?o.apply(t,r):o)||(e.exports=a)}})}));
//# sourceMappingURL=index-wechat.min.js.map