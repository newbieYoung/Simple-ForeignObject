!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.simplescreenshot=t():e.SimpleScreenshot=t()}(window,(function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){var i,n,r;n=[o(1)],void 0===(r="function"==typeof(i=function(e){Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){let o=Object(this),i=o.length>>>0;if(0===i)return!1;let n=0|t,r=Math.max(n>=0?n:i-Math.abs(n),0);for(;r<i;){if((l=o[r])===(s=e)||"number"==typeof l&&"number"==typeof s&&isNaN(l)&&isNaN(s))return!0;r++}var l,s;return!1}});let t=e.dash("transform"),o=e.dash("transformOrigin"),i=/url\(['"]?([^'"]+?)['"]?\)/g,n=function(e){let t=e.content,o=e.display,i=!0;return null!=t?(t=t.trim(),("none"==t||""==t&&"inline"==o)&&(i=!1)):i=!1,o&&"none"!=o||(i=!1),i},r=[],l=[];function s(e){return e&&"[object Function]"==={}.toString.call(e)}const a=["width","height","background-attachment","background-blend-mode","background-clip","-webkit-background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","bottom","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","content","cursor","direction","display","empty-cells","float","font-family","font-kerning","font-optical-sizing","font-size","font-stretch","font-style","font-variant","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-weight","image-rendering","isolation","justify-items","justify-self","left","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","margin-bottom","margin-left","margin-right","margin-top","max-height","max-width","min-height","min-width","mix-blend-mode","object-fit","object-position","offset-distance","offset-path","offset-rotate","opacity","orphans","outline-color","outline-offset","outline-style","outline-width","overflow-anchor","overflow-wrap","overflow-x","overflow-y","padding-bottom","padding-left","padding-right","padding-top","pointer-events","position","resize","right","scroll-behavior","speak","table-layout","tab-size","text-align","text-align-last","text-decoration","text-decoration-line","text-decoration-style","text-decoration-color","text-decoration-skip-ink","text-underline-position","text-indent","text-rendering","text-shadow","text-size-adjust","text-overflow","text-transform","top","touch-action","unicode-bidi","vertical-align","visibility","white-space","widows","will-change","word-break","word-spacing","z-index","zoom","-webkit-appearance","backface-visibility","-webkit-border-horizontal-spacing","-webkit-border-image","-webkit-border-vertical-spacing","-webkit-box-align","-webkit-box-decoration-break","-webkit-box-direction","-webkit-box-flex","-webkit-box-ordinal-group","-webkit-box-orient","-webkit-box-pack","-webkit-box-reflect","column-count","column-gap","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","backdrop-filter","align-content","align-items","align-self","flex-basis","flex-grow","flex-shrink","flex-direction","flex-wrap","justify-content","-webkit-font-smoothing","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column-end","grid-column-start","grid-template-areas","grid-template-columns","grid-template-rows","grid-row-end","grid-row-start","row-gap","-webkit-highlight","hyphens","-webkit-hyphenate-character","-webkit-line-break","-webkit-line-clamp","-webkit-locale","-webkit-margin-before-collapse","-webkit-margin-after-collapse","-webkit-mask-box-image","-webkit-mask-box-image-outset","-webkit-mask-box-image-repeat","-webkit-mask-box-image-slice","-webkit-mask-box-image-source","-webkit-mask-box-image-width","-webkit-mask-clip","-webkit-mask-composite","-webkit-mask-image","-webkit-mask-origin","-webkit-mask-position","-webkit-mask-repeat","-webkit-mask-size","order","perspective","perspective-origin","-webkit-print-color-adjust","-webkit-rtl-ordering","shape-outside","shape-image-threshold","shape-margin","-webkit-tap-highlight-color","-webkit-text-combine","-webkit-text-decorations-in-effect","-webkit-text-emphasis-color","-webkit-text-emphasis-position","-webkit-text-emphasis-style","-webkit-text-fill-color","-webkit-text-orientation","-webkit-text-security","-webkit-text-stroke-color","-webkit-text-stroke-width","transform","transform-origin","transform-style","-webkit-user-drag","-webkit-user-modify","user-select","-webkit-writing-mode","-webkit-app-region","buffered-rendering","clip-path","clip-rule","mask","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","marker-end","marker-mid","marker-start","mask-type","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","alignment-baseline","baseline-shift","dominant-baseline","text-anchor","writing-mode","vector-effect","paint-order","d","cx","cy","x","y","r","rx","ry","caret-color","line-break"];function d(e){this.devicePixelRatio=e.devicePixelRatio||1,this.error=e.error||function(){},this.log=e.log||console.log,this.puppeteerServer=e.puppeteerServer,this.puppeteerGlobalFont=e.puppeteerGlobalFont,this.pupServerCanModifyFont=!e.pupServerCanModifyFont||e.pupServerCanModifyFont,this.imgType=e.imgType||"jpeg",this.imgQuality=parseInt(e.imgQuality)||80,this.distWidth=e.distWidth,this.distHeight=e.distHeight,this.debug=!!e.debug,this.supportForeignObject=!1,this.forceScreenshotType=e.forceScreenshotType,"client"==this.forceScreenshotType?this.supportForeignObject=!0:this.checkForeignObject(),this._isLoading=!1,this._wholeTexts="",this._globalInlineFont={list:[],value:""},this.globalInlineFont=e.globalInlineFont||"",this.fontList=[];let o=e.fontList||[];for(let e=0;e<o.length;e++)this.fontList.push({name:o[e],texts:""});this.preLoadResource=e.preLoadResource||[];for(let e=0;e<this.preLoadResource.length;e++){let t=this.preLoadResource[e].name,o=this.preLoadResource[e].data;o&&""!=o&&(r.push(t),l.push(o))}this.parentCSS=e.parentCSS||[{name:"opacity",value:1},{name:t,value:""},{name:"filter",value:""}],this.parseCSSFilter=e.parseCSSFilter||[],this.rules={autoRenderWidth:!1},this.analysisStyleSheets()}return d.prototype.analysisStyleSheets=function(){this._hasWidthNodes=[],this._hasHeightNodes=[];try{let e=document.styleSheets;for(let t=0;t<e.length;t++){let o=e[t];for(let e=0;e<o.cssRules.length;e++){let t=o.cssRules[e];if(1==t.type){if(t.style.width){let e=document.querySelectorAll(t.selectorText);for(let o=0;o<e.length;o++)t.style.width&&(this._hasWidthNodes.includes[e[o]]||this._hasWidthNodes.push(e[o]))}}else 3==t.type||4==t.type||5==t.type&&this.loadResource({name:t.style.fontFamily,value:t.style.src},(function(){}),(function(){}))}}}catch(e){}},d.prototype.checkForeignObject=function(){let e="";e+="<svg xmlns='http://www.w3.org/2000/svg' width='1' height='1'>",e+="<foreignObject width='100%' height='100%'>",e+="<div xmlns='http://www.w3.org/1999/xhtml' style='width:100%;height:100%;background-color:red;'></div>",e+="</foreignObject>",e+="</svg>";let t=this,o=new Image;o.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' width='1' height='1'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='width:100%;height:100%;background-color:red;'></div></foreignObject></svg>"),o.onload=function(){let e=document.createElement("canvas");e.width=1,e.height=1;let i=e.getContext("2d");i.drawImage(o,0,0,1,1);let n=i.getImageData(0,0,1,1).data;255==n[0]&&0==n[1]&&0==n[2]&&255==n[3]&&(t.supportForeignObject=!0)}},d.prototype.nodeItem=function(e,t){if(e.nodeType!=Node.ELEMENT_NODE)return;let o=e.tagName.toLowerCase(),i={node:e,dataset:{level:t,name:o},style:{},after:null,before:null};"img"==o&&(i.dataset.src=e.getAttribute("src")),i.computedStyle=window.getComputedStyle(e);let r=window.getComputedStyle(e,":after");n(r)&&(i.after=r);let l=window.getComputedStyle(e,":before");n(l)&&(i.before=l),this.nodes.push(i);let s=0,a=e.childNodes;for(let e=0;e<a.length;e++){let o=a[e];o.nodeType==Node.ELEMENT_NODE&&(this.nodeItem(o,t+"-"+s),s++)}},d.prototype.toSVG=function(e,i){this._wholeTexts="",this.nodes=[];let n=document.querySelector(e);this.nodeItem(n,0);let r=this;this.parseCSSRules((function(){r.root=r.getNodeByLevel("0");let e=r.root.node.getBoundingClientRect(),n=parseFloat(e.width)*r.devicePixelRatio,l=parseFloat(e.height)*r.devicePixelRatio,s=r.toHTML(r.root,!0),a="";a+="<svg xmlns='http://www.w3.org/2000/svg'",a+=" width='"+n+"'",a+=" height='"+l+"'",a+=">",a+="<foreignObject width='100%' height='100%'>",a+="<div xmlns='http://www.w3.org/1999/xhtml' style='","inline-block"==r.root.display&&(a+="font-size : 0 ;"),r.parentCSS=r.calcParentProperty(r.root);for(let e=0;e<r.parentCSS.length;e++){let o=r.parentCSS[e];o.value=null==o.value?"":(o.value+"").trim(),o.name==t&&(o.value+=" scale("+r.devicePixelRatio+")"),""!=o.value&&(a+=o.name+" : "+o.value+" ;")}a+=o+":0 0;'>",a+=s,a+="</div>",a+="</foreignObject>",a+="</svg>",i({svg:a,width:e.width,height:e.height,devicePixelRatio:r.devicePixelRatio,distWidth:r.distWidth?r.distWidth:e.width*r.devicePixelRatio,distHeight:r.distHeight?r.distHeight:e.height*r.devicePixelRatio,fonts:r.fontList,imgType:r.imgType,imgQuality:r.imgQuality})}))},d.prototype.calcParentProperty=function(e){let o=[{name:"opacity",value:1},{name:t,value:""},{name:"filter",value:""}],i=e.node.parentElement;for(;null!=i;){let e=window.getComputedStyle(i);for(let i=0;i<o.length;i++){let n=o[i],r=e.getPropertyValue(n.name);switch(n.name){case"opacity":r=null==r?1:parseFloat(r),n.value*=r;break;case"filter":case t:r=null==r||"none"==r?"":" "+r,n.value+=r}}i=i.parentElement}return o},d.prototype.toIMG=function(e,t){let o=this;o.toSVG(e,(function(e){if(o.supportForeignObject&&"server"!=o.forceScreenshotType){let i=e.svg.indexOf("</style>");e.svg=e.svg.substring(0,i)+o._globalInlineFont.value+e.svg.substring(i,e.svg.length),o.debug&&o.log(e);let n="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e.svg);o.toCanvas(n,e,(function(o){t({canvas:o,base64:o.toDataURL("image/"+e.imgType,e.imgQuality/100)})}))}else{o.puppeteerGlobalFont&&(o.pupServerCanModifyFont||o.fontList.push({name:o.puppeteerGlobalFont,texts:o._wholeTexts}),e.globalFont=o.puppeteerGlobalFont),o.debug&&o.log(e);let i=new XMLHttpRequest;i.open("POST",o.puppeteerServer),i.onerror=function(e){o.error(e)},i.ontimeout=function(e){o.error(e)},i.onload=function(){o.toCanvas(i.response,e,(function(e){t({canvas:e,base64:i.response})}))},i.send(JSON.stringify(e))}}))},d.prototype.toCanvas=function(e,t,o){let i=new Image;i.width=parseInt(t.distWidth),i.height=parseInt(t.distHeight),i.onload=function(){let e=document.createElement("canvas");e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0,i.width,i.height),s(o)&&o(e)},i.src=e},d.prototype.toHTML=function(e,t){let o="",i="",n=this.parseCSS(e,t);e.after&&(i+="<span style='"+n.after+"'></span>"),e.before&&(i+="<span style='"+n.before+"'></span>");let s=e.node.childNodes,a=0;for(let t=0;t<s.length;t++){let o=s[t];if(o.nodeType==Node.ELEMENT_NODE){let t=e.dataset.level+"-"+a,o=this.getNodeByLevel(t);o&&(i+=this.toHTML(o,!1),a++)}else{let t=this.getNodeStyle(e,"font-family");for(let e=0;e<this.fontList.length;e++){let i=this.fontList[e];if(t.includes(i.name))for(let e=0;e<o.wholeText.length;e++)i.texts.includes(o.wholeText[e])||(i.texts+=o.wholeText[e])}for(let e=0;e<o.wholeText.length;e++)this._wholeTexts.includes(o.wholeText[e])||(this._wholeTexts+=o.wholeText[e]);i+=o.wholeText.replace(/[\r\n]/g,"").replace(/&/g,"&amp;")}}let d=e.dataset.name;if(o+="<"+d+" xmlns='http://www.w3.org/1999/xhtml'",e.dataset.src){let t=r.indexOf(e.dataset.src);o+=-1!=t?" src='"+l[t]+"'":" src='"+e.dataset.src+"'"}return t?(o+=" id='simple-screenshot'>",o+="<style>",o+="#simple-screenshot,#simple-screenshot *:not(style){"+n.style+"} "+this.globalInlineFont,o+="</style>"):o+=" style='"+n.style+"'>",o+=i,o+="</"+d+">",o},d.prototype.parseCSS=function(e,t){let o="",i="",n="";e._rules={autoRenderWidth:this.rules.autoRenderWidth};for(let t=0;t<this.parseCSSFilter.length;t++){let o=this.parseCSSFilter[t];s(o)&&o(e)}for(let s=0;s<a.length;s++){let d=a[s];if(t)(["margin-top","margin-left","margin-bottom","margin-right"].includes(d)||["absolute","fixed"].includes(this.getNodeStyle(e,"position"))&&["top","bottom","left","right"].includes(d))&&this.setNodeStyle(e,d,0);else if(this.getNodeStyle(e,d)==this.getNodeStyle(this.root,d))continue;if("background-image"==d)o+=this.parseBackgroundImage(this.getNodeStyle(e,d)),e.after&&(i+=this.parseBackgroundImage(e.after[d])),e.before&&(n+=this.parseBackgroundImage(e.before[d]));else{let t=this.getNodeStyle(e,d);if(o+=d+":"+t+";","font-family"==d){let e=r.indexOf(t);-1==e||this._globalInlineFont.list.includes(t)||(this._globalInlineFont.list.push(t),this._globalInlineFont.value+="@font-face {font-family: '"+t+"';src: url("+l[e]+");}")}if(e.after){let t=e.after[d];if(i+=d+":"+t+";","font-family"==d){let e=r.indexOf(t);-1==e||this._globalInlineFont.list.includes(t)||(this._globalInlineFont.list.push(t),this._globalInlineFont.value+="@font-face {font-family: '"+t+"';src: url("+l[e]+");}")}}if(e.before){let t=e.before[d];if(n+=d+":"+t+";","font-family"==d){let e=r.indexOf(t);-1==e||this._globalInlineFont.list.includes(t)||(this._globalInlineFont.list.push(t),this._globalInlineFont.value+="@font-face {font-family: '"+t+"';src: url("+l[e]+");}")}}}}return!e._rules.autoRenderWidth&&this._hasWidthNodes.includes(e.node)||t||(o+="width: auto;"),{style:o,after:i,before:n}},d.prototype.parseBackgroundImage=function(e){let t=null,o="",n=!1;if(i.lastIndex=0,t=i.exec(e),null!=t){let i=t[1];if(e&&i&&-1==i.search(/^(data:)/)){let e=r.indexOf(i);n=!0,o+=-1!=e?"background-image : url("+l[e]+");":"background-image : url("+encodeURIComponent(i)+");"}}return n||(o+="background-image :"+e+";"),o},d.prototype.setNodeStyle=function(e,t,o){e.style[t]=o},d.prototype.getNodeStyle=function(e,t){return null!=e.style[t]?e.style[t]:e.computedStyle[t]},d.prototype.getNodeByLevel=function(e){for(let t=0;t<this.nodes.length;t++)if(this.nodes[t].dataset.level==e)return this.nodes[t];return null},d.prototype.parseCSSRules=function(e){let t=0,o=this;o._isLoading=!1;let i=function(){o._isLoading=!0,t++},n=function(){t--,0==t&&(o._isLoading=!0,e())};for(let e=0;e<this.nodes.length;e++){let t=this.nodes[e];t.dataset.src&&t.dataset.src.length>0&&this.loadResource({value:"url("+t.dataset.src+")"},i,n);let o=t.computedStyle["background-image"];if(o&&o.length>0&&"none"!=o&&this.loadResource({value:o},i,n),t.after){let e=t.after["background-image"];e&&e.length>0&&"none"!=e&&this.loadResource({value:e},i,n)}if(t.before){let e=t.before["background-image"];e&&e.length>0&&"none"!=e&&this.loadResource({value:e},i,n)}}0==t&&e()},d.prototype.getType=function(e){let t=[".png",".jpg",".jpeg",".ttf"],o=["image/png","image/jpg","image/jpg","application/x-font-ttf"];for(let i=0;i<t.length;i++)if(e.lastIndexOf(t[i])+t[i].length==e.length)return o[i];return o[0]},d.prototype.loadResource=function(e,t,o){i.lastIndex=0;let n=i.exec(e.value),s=this;if(null!=n){let i=n[1],a=e.name?e.name:i;if(e.value&&i&&!r.includes(a)&&null!=this.getType(i))if(-1==i.search(/^(data:)/)){r.push(a),t();let e=new XMLHttpRequest;e.responseType="blob",e.timeout=3e3,e.open("GET",i,!0),e.onerror=function(e){s.error({msg:i+" request error",err:e})},e.ontimeout=function(e){s.error({msg:i+" request timeout",err:e})},e.onload=function(){let t=new FileReader;t.onload=function(){s.log({msg:i+" request onload"});let e=r.indexOf(a);l[e]=t.result,o()},t.readAsDataURL(e.response)},e.send()}else e.name&&(r.push(a),l.push(i))}},d})?i.apply(t,n):i)||(e.exports=r)},function(e,t,o){var i,n,r;n=[],void 0===(r="function"==typeof(i=function(){var e="undefined"!=typeof document?document.createElement("p").style:{},t=["O","ms","Moz","Webkit"],o=/([A-Z])/g,i={};function n(o){if(o=o.replace(/-([a-z])/g,(function(e,t){return t.toUpperCase()})),void 0!==e[o])return o;for(var i=o.charAt(0).toUpperCase()+o.slice(1),n=t.length;n--;){var r=t[n]+i;if(void 0!==e[r])return r}return o}return{prefix:function(e){return e in i?i[e]:i[e]=n(e)},dash:function(e){return e=n(e),o.test(e)&&(e=e.replace(o,"-$1"),o.lastIndex=0),e.toLowerCase()}}})?i.apply(t,n):i)||(e.exports=r)}])}));
//# sourceMappingURL=index-web.min.js.map