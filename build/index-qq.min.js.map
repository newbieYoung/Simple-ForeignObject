{"version":3,"sources":["webpack://SimpleScreenshot/webpack/universalModuleDefinition","webpack://SimpleScreenshot/webpack/bootstrap","webpack://SimpleScreenshot/./index-qq.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","URL_REGEX","RESOURCE_NAME","RESOURCE_DATA","COMPUTED_STYLE","SimpleScreenshot","params","this","devicePixelRatio","error","log","console","puppeteerServer","puppeteerGlobalFont","pupServerCanModifyFont","imgType","imgQuality","parseInt","distWidth","distHeight","debug","supportForeignObject","forceScreenshotType","_isLoading","_wholeTexts","fontList","length","push","texts","globalInlineFont","preLoadResource","data","parentCSS","parseCSSFilter","rules","autoRenderWidth","toSVG","selector","callback","self","qq","createSelectorQuery","selectAll","fields","dataset","size","computedStyle","nodes","parseCSSRules","getNodeByLevel","width","parseFloat","height","html","toHTML","svg","display","pCSS","trim","fonts","exec","toIMG","globalFont","request","url","method","res","err","node","isRoot","inner","tagName","getNodeName","style","parseCSS","curLevel","level","childLen","len","textChilds","JSON","parse","replace","text","msg","childLevel","isText","j","fontFamily","z","fontItem","includes","k","child","src","index","indexOf","_rules","filter","obj","toString","matches","isReplaceResource","lastIndex","search","encodeURIComponent","realWidth","realHeight","borderBottomWidth","borderTopWidth","borderLeftWidth","borderRightWidth","paddingTop","paddingLeft","paddingBottom","paddingRight","finished","count","add","del","canvasid","loadResource","bgImg","canvasWidth","canvaswidth","canvasHeight","canvasheight","canvasId","canvasToTempFilePath","destWidth","destHeight","base64","getFileSystemManager","readFileSync","tempFilePath","resource","type","getType","responseType","success","arrayBufferToBase64","fail","nodeName","types","names","lastIndexOf","clearResourceCache"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAA0B,iBAAID,IAE9BD,EAAuB,iBAAIC,IAR7B,CASGK,QAAQ,WACX,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUP,QAGnC,IAAIC,EAASI,EAAiBE,GAAY,CACzCC,EAAGD,EACHE,GAAG,EACHT,QAAS,IAUV,OANAU,EAAQH,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOQ,GAAI,EAGJR,EAAOD,QA0Df,OArDAM,EAAoBM,EAAIF,EAGxBJ,EAAoBO,EAAIR,EAGxBC,EAAoBQ,EAAI,SAASd,EAASe,EAAMC,GAC3CV,EAAoBW,EAAEjB,EAASe,IAClCG,OAAOC,eAAenB,EAASe,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEV,EAAoBgB,EAAI,SAAStB,GACX,oBAAXuB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAenB,EAASuB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAenB,EAAS,aAAc,CAAEyB,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBQ,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAShC,GAChC,IAAIe,EAASf,GAAUA,EAAO2B,WAC7B,WAAwB,OAAO3B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAK,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG7B,EAAoBgC,EAAI,GAIjBhC,EAAoBA,EAAoBiC,EAAI,G,oBClFrD,UAII,EAAO,QAAW,0BAAP,EAQZ,WAOD,IAAIC,EAAY,8BACZC,EAAgB,GAChBC,EAAgB,GAUpB,MAAMC,EAAiB,CAIrB,wBACA,wBACA,kBACA,mBACA,mBACA,oBACA,sBACA,oBACA,kBACA,sBACA,4BACA,6BACA,sBACA,sBACA,kBACA,sBACA,sBACA,qBACA,sBACA,qBACA,oBACA,oBACA,oBACA,qBACA,qBACA,qBACA,mBACA,yBACA,0BACA,mBACA,mBACA,SACA,aACA,aACA,cACA,eACA,eACA,eACA,QACA,OACA,QACA,UACA,SACA,YACA,UACA,cACA,QACA,cACA,eACA,sBACA,YACA,eACA,aACA,eACA,yBACA,oBACA,uBACA,0BACA,cACA,kBACA,YACA,gBACA,eACA,OACA,iBACA,cACA,mBACA,sBACA,kBACA,gBACA,cACA,eACA,aACA,aACA,YACA,aACA,YACA,iBACA,aACA,kBACA,kBACA,cACA,gBACA,UACA,UACA,gBACA,iBACA,gBACA,gBACA,kBACA,gBACA,aACA,aACA,iBACA,eACA,gBACA,cACA,iBACA,WACA,SACA,QACA,kBACA,QACA,eACA,WACA,aACA,kBACA,kBACA,uBACA,wBACA,wBACA,2BACA,0BACA,cACA,iBACA,cACA,mBACA,gBACA,iBACA,MACA,eACA,eACA,iBACA,aACA,cACA,SACA,cACA,aACA,eACA,UACA,OACA,qBACA,sBACA,oCACA,uBACA,kCACA,oBACA,+BACA,wBACA,mBACA,4BACA,qBACA,mBACA,sBACA,eACA,aACA,oBACA,oBACA,oBACA,cACA,eACA,kBACA,gBACA,cACA,aACA,aACA,YACA,cACA,iBACA,YACA,kBACA,yBACA,oBACA,iBACA,iBACA,kBACA,oBACA,sBACA,wBACA,qBACA,eACA,iBACA,UACA,oBACA,UACA,8BACA,qBACA,qBACA,iBACA,iCACA,gCACA,yBACA,gCACA,gCACA,+BACA,gCACA,+BACA,oBACA,yBACA,qBACA,sBACA,wBACA,sBACA,oBACA,QACA,cACA,qBACA,6BACA,uBACA,gBACA,wBACA,eACA,8BACA,uBACA,qCACA,8BACA,iCACA,8BACA,0BACA,2BACA,wBACA,4BACA,4BACA,YACA,mBACA,kBACA,oBACA,sBACA,cACA,uBACA,qBACA,qBACA,YACA,YACA,OACA,SACA,cACA,gBACA,iBACA,aACA,eACA,sBACA,8BACA,kBACA,OACA,eACA,YACA,aACA,aACA,eACA,YACA,kBACA,SACA,mBACA,oBACA,iBACA,kBACA,oBACA,iBACA,eACA,qBACA,iBACA,oBACA,cACA,eACA,gBACA,cACA,IACA,KACA,KACA,IACA,IACA,IACA,KACA,KACA,cACA,cAGF,SAASC,EAAiBC,GACxBC,KAAKC,iBAAmBF,EAAOE,kBAAoB,EACnDD,KAAKE,MAAQH,EAAOG,OAAS,aAC7BF,KAAKG,IAAMJ,EAAOI,KAAOC,QAAQD,IACjCH,KAAKK,gBAAkBN,EAAOM,gBAC9BL,KAAKM,oBAAsBP,EAAOO,oBAClCN,KAAKO,wBAAyBR,EAAOQ,wBAAyBR,EAAOQ,uBACrEP,KAAKQ,QAAUT,EAAOS,SAAW,OACjCR,KAAKS,WAAaC,SAASX,EAAOU,aAAe,GACjDT,KAAKW,UAAYZ,EAAOY,UACxBX,KAAKY,WAAab,EAAOa,WACzBZ,KAAKa,QAASd,EAAOc,MAGrBb,KAAKc,sBAAuB,EAC5Bd,KAAKe,oBAAsB,SAE3Bf,KAAKgB,YAAa,EAClBhB,KAAKiB,YAAc,GAGnBjB,KAAKkB,SAAW,GAChB,IAAIA,EAAWnB,EAAOmB,UAAY,GAClC,IAAK,IAAIxD,EAAI,EAAGA,EAAIwD,EAASC,OAAQzD,IACnCsC,KAAKkB,SAASE,KAAK,CACjBnD,KAAMiD,EAASxD,GACf2D,MAAO,KAIXrB,KAAKsB,iBAAmBvB,EAAOu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","file":"index-qq.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"simplescreenshot\"] = factory();\n\telse\n\t\troot[\"SimpleScreenshot\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/* global define module qq */\n(function (factory) {\n  if (typeof define === \"function\" && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof module === \"object\" && module.exports) {\n    // Node/CommonJS\n    module.exports = factory();\n  } else {\n    // Browser globals\n    window.SimpleScreenshot = factory();\n  }\n})(function () {\n  /**\n   * 小程序目前无法处理以下情况：\n   * 1、after、before 等伪类元素；\n   * 2、加载项目内资源文件；\n   */\n\n  let URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n  let RESOURCE_NAME = [];\n  let RESOURCE_DATA = [];\n\n  function isFunction(obj) {\n    // 判断对象是否是function\n    return obj && {}.toString.call(obj) === \"[object Function]\";\n  }\n\n  /**\n   * window.getComputedStyle 去掉 animation、transition\n   */\n  const COMPUTED_STYLE = [\n    //使用小程序 size 属性代替 computedStyle 中的 width、height\n    //\"width\",\n    //\"height\",\n    \"background-attachment\",\n    \"background-blend-mode\",\n    \"background-clip\",\n    \"background-color\",\n    \"background-image\",\n    \"background-origin\",\n    \"background-position\",\n    \"background-repeat\",\n    \"background-size\",\n    \"border-bottom-color\",\n    \"border-bottom-left-radius\",\n    \"border-bottom-right-radius\",\n    \"border-bottom-style\",\n    \"border-bottom-width\",\n    \"border-collapse\",\n    \"border-image-outset\",\n    \"border-image-repeat\",\n    \"border-image-slice\",\n    \"border-image-source\",\n    \"border-image-width\",\n    \"border-left-color\",\n    \"border-left-style\",\n    \"border-left-width\",\n    \"border-right-color\",\n    \"border-right-style\",\n    \"border-right-width\",\n    \"border-top-color\",\n    \"border-top-left-radius\",\n    \"border-top-right-radius\",\n    \"border-top-style\",\n    \"border-top-width\",\n    \"bottom\",\n    \"box-shadow\",\n    \"box-sizing\",\n    \"break-after\",\n    \"break-before\",\n    \"break-inside\",\n    \"caption-side\",\n    \"clear\",\n    \"clip\",\n    \"color\",\n    \"content\",\n    \"cursor\",\n    \"direction\",\n    \"display\",\n    \"empty-cells\",\n    \"float\",\n    \"font-family\",\n    \"font-kerning\",\n    \"font-optical-sizing\",\n    \"font-size\",\n    \"font-stretch\",\n    \"font-style\",\n    \"font-variant\",\n    \"font-variant-ligatures\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n    \"font-weight\",\n    \"image-rendering\",\n    \"isolation\",\n    \"justify-items\",\n    \"justify-self\",\n    \"left\",\n    \"letter-spacing\",\n    \"line-height\",\n    \"list-style-image\",\n    \"list-style-position\",\n    \"list-style-type\",\n    \"margin-bottom\",\n    \"margin-left\",\n    \"margin-right\",\n    \"margin-top\",\n    \"max-height\",\n    \"max-width\",\n    \"min-height\",\n    \"min-width\",\n    \"mix-blend-mode\",\n    \"object-fit\",\n    \"object-position\",\n    \"offset-distance\",\n    \"offset-path\",\n    \"offset-rotate\",\n    \"opacity\",\n    \"orphans\",\n    \"outline-color\",\n    \"outline-offset\",\n    \"outline-style\",\n    \"outline-width\",\n    \"overflow-anchor\",\n    \"overflow-wrap\",\n    \"overflow-x\",\n    \"overflow-y\",\n    \"padding-bottom\",\n    \"padding-left\",\n    \"padding-right\",\n    \"padding-top\",\n    \"pointer-events\",\n    \"position\",\n    \"resize\",\n    \"right\",\n    \"scroll-behavior\",\n    \"speak\",\n    \"table-layout\",\n    \"tab-size\",\n    \"text-align\",\n    \"text-align-last\",\n    \"text-decoration\",\n    \"text-decoration-line\",\n    \"text-decoration-style\",\n    \"text-decoration-color\",\n    \"text-decoration-skip-ink\",\n    \"text-underline-position\",\n    \"text-indent\",\n    \"text-rendering\",\n    \"text-shadow\",\n    \"text-size-adjust\",\n    \"text-overflow\",\n    \"text-transform\",\n    \"top\",\n    \"touch-action\",\n    \"unicode-bidi\",\n    \"vertical-align\",\n    \"visibility\",\n    \"white-space\",\n    \"widows\",\n    \"will-change\",\n    \"word-break\",\n    \"word-spacing\",\n    \"z-index\",\n    \"zoom\",\n    \"-webkit-appearance\",\n    \"backface-visibility\",\n    \"-webkit-border-horizontal-spacing\",\n    \"-webkit-border-image\",\n    \"-webkit-border-vertical-spacing\",\n    \"-webkit-box-align\",\n    \"-webkit-box-decoration-break\",\n    \"-webkit-box-direction\",\n    \"-webkit-box-flex\",\n    \"-webkit-box-ordinal-group\",\n    \"-webkit-box-orient\",\n    \"-webkit-box-pack\",\n    \"-webkit-box-reflect\",\n    \"column-count\",\n    \"column-gap\",\n    \"column-rule-color\",\n    \"column-rule-style\",\n    \"column-rule-width\",\n    \"column-span\",\n    \"column-width\",\n    \"backdrop-filter\",\n    \"align-content\",\n    \"align-items\",\n    \"align-self\",\n    \"flex-basis\",\n    \"flex-grow\",\n    \"flex-shrink\",\n    \"flex-direction\",\n    \"flex-wrap\",\n    \"justify-content\",\n    \"-webkit-font-smoothing\",\n    \"grid-auto-columns\",\n    \"grid-auto-flow\",\n    \"grid-auto-rows\",\n    \"grid-column-end\",\n    \"grid-column-start\",\n    \"grid-template-areas\",\n    \"grid-template-columns\",\n    \"grid-template-rows\",\n    \"grid-row-end\",\n    \"grid-row-start\",\n    \"row-gap\",\n    \"-webkit-highlight\",\n    \"hyphens\",\n    \"-webkit-hyphenate-character\",\n    \"-webkit-line-break\",\n    \"-webkit-line-clamp\",\n    \"-webkit-locale\",\n    \"-webkit-margin-before-collapse\",\n    \"-webkit-margin-after-collapse\",\n    \"-webkit-mask-box-image\",\n    \"-webkit-mask-box-image-outset\",\n    \"-webkit-mask-box-image-repeat\",\n    \"-webkit-mask-box-image-slice\",\n    \"-webkit-mask-box-image-source\",\n    \"-webkit-mask-box-image-width\",\n    \"-webkit-mask-clip\",\n    \"-webkit-mask-composite\",\n    \"-webkit-mask-image\",\n    \"-webkit-mask-origin\",\n    \"-webkit-mask-position\",\n    \"-webkit-mask-repeat\",\n    \"-webkit-mask-size\",\n    \"order\",\n    \"perspective\",\n    \"perspective-origin\",\n    \"-webkit-print-color-adjust\",\n    \"-webkit-rtl-ordering\",\n    \"shape-outside\",\n    \"shape-image-threshold\",\n    \"shape-margin\",\n    \"-webkit-tap-highlight-color\",\n    \"-webkit-text-combine\",\n    \"-webkit-text-decorations-in-effect\",\n    \"-webkit-text-emphasis-color\",\n    \"-webkit-text-emphasis-position\",\n    \"-webkit-text-emphasis-style\",\n    \"-webkit-text-fill-color\",\n    \"-webkit-text-orientation\",\n    \"-webkit-text-security\",\n    \"-webkit-text-stroke-color\",\n    \"-webkit-text-stroke-width\",\n    \"transform\",\n    \"transform-origin\",\n    \"transform-style\",\n    \"-webkit-user-drag\",\n    \"-webkit-user-modify\",\n    \"user-select\",\n    \"-webkit-writing-mode\",\n    \"-webkit-app-region\",\n    \"buffered-rendering\",\n    \"clip-path\",\n    \"clip-rule\",\n    \"mask\",\n    \"filter\",\n    \"flood-color\",\n    \"flood-opacity\",\n    \"lighting-color\",\n    \"stop-color\",\n    \"stop-opacity\",\n    \"color-interpolation\",\n    \"color-interpolation-filters\",\n    \"color-rendering\",\n    \"fill\",\n    \"fill-opacity\",\n    \"fill-rule\",\n    \"marker-end\",\n    \"marker-mid\",\n    \"marker-start\",\n    \"mask-type\",\n    \"shape-rendering\",\n    \"stroke\",\n    \"stroke-dasharray\",\n    \"stroke-dashoffset\",\n    \"stroke-linecap\",\n    \"stroke-linejoin\",\n    \"stroke-miterlimit\",\n    \"stroke-opacity\",\n    \"stroke-width\",\n    \"alignment-baseline\",\n    \"baseline-shift\",\n    \"dominant-baseline\",\n    \"text-anchor\",\n    \"writing-mode\",\n    \"vector-effect\",\n    \"paint-order\",\n    \"d\",\n    \"cx\",\n    \"cy\",\n    \"x\",\n    \"y\",\n    \"r\",\n    \"rx\",\n    \"ry\",\n    \"caret-color\",\n    \"line-break\",\n  ];\n\n  function SimpleScreenshot(params) {\n    this.devicePixelRatio = params.devicePixelRatio || 1;\n    this.error = params.error || function () {};\n    this.log = params.log || console.log;\n    this.puppeteerServer = params.puppeteerServer; // puppeteer 截屏服务\n    this.puppeteerGlobalFont = params.puppeteerGlobalFont; // puppeteer 截屏服务全局字体\n    this.pupServerCanModifyFont = params.pupServerCanModifyFont ? params.pupServerCanModifyFont : true; // puppeteer 截屏服务是否支持配置字体\n    this.imgType = params.imgType || 'jpeg'; //图片类型\n    this.imgQuality = parseInt(params.imgQuality) || 80; //图片质量\n    this.distWidth = params.distWidth; //目标尺寸\n    this.distHeight = params.distHeight;\n    this.debug = !params.debug ? false : true; // 调试模式\n\n    //小程序目前并不支持客户端渲染 svg foreignobject\n    this.supportForeignObject = false;\n    this.forceScreenshotType = 'server';\n\n    this._isLoading = false; //是否正在加载资源\n    this._wholeTexts = \"\"; // 全部文字\n\n    //字体列表\n    this.fontList = [];\n    let fontList = params.fontList || [];\n    for (let i = 0; i < fontList.length; i++) {\n      this.fontList.push({\n        name: fontList[i],\n        texts: \"\",\n      });\n    }\n\n    this.globalInlineFont = params.globalInlineFont || \"\";\n\n    //预加载资源\n    this.preLoadResource = params.preLoadResource || [];\n    for (let i = 0; i < this.preLoadResource.length; i++) {\n      let name = this.preLoadResource[i].name;\n      let data = this.preLoadResource[i].data;\n      if (data && data != \"\") {\n        RESOURCE_NAME.push(name);\n        RESOURCE_DATA.push(data);\n      }\n    }\n\n    /**\n     * 父元素的部分属性对子元素有影响，但是并不会被子元素继承，比如：opacity、transform、filter；\n     * 但是小程序中没办法获取父节点元素，目前的解决办法是手动计算，然后通过参数传递。\n     */\n    this.parentCSS = params.parentCSS || [{\n        name: \"opacity\",\n        value: 1,\n      },\n      {\n        name: \"transform\", // 因为是给子元素截图，父元素的 transform-origin 等属性可以不考虑\n        value: \"\",\n      },\n      {\n        name: \"filter\",\n        value: \"\",\n      },\n    ];\n\n    //自定义 css 解析过滤器\n    this.parseCSSFilter = params.parseCSSFilter || [];\n\n    /**\n     * 特殊规则\n     * autoRenderWidth 自适应渲染宽度，在小程序中因为字体原因，某些文字元素 fields size 并不精确，导致文字超出容器，从而溢出换行。\n     */\n    this.rules = {\n      autoRenderWidth: false,\n    };\n  }\n\n  SimpleScreenshot.prototype.toSVG = function (selector, callback) {\n    let self = this;\n    self._wholeTexts = \"\";\n    qq.createSelectorQuery()\n      .selectAll(selector)\n      .fields({\n          dataset: true,\n          size: true,\n          computedStyle: COMPUTED_STYLE,\n        },\n        function (nodes) {\n          self.nodes = nodes;\n          self.parseCSSRules(function () {\n            self.root = self.getNodeByLevel(\"0\");\n            let width = parseFloat(self.root.width) * self.devicePixelRatio;\n            let height = parseFloat(self.root.height) * self.devicePixelRatio;\n            let html = self.toHTML(self.root, true);\n\n            let svg = \"\";\n            svg += \"<svg xmlns='http://www.w3.org/2000/svg'\";\n            svg += \" width='\" + width + \"'\";\n            svg += \" height='\" + height + \"'\";\n            svg += \">\";\n            svg += \"<foreignObject width='100%' height='100%'>\";\n            svg += \"<div xmlns='http://www.w3.org/1999/xhtml' style='\";\n            if (self.root.display == \"inline-block\") {\n              // 防止行内元素的布局被空白字符挤乱\n              svg += \"font-size : 0 ;\";\n            }\n\n            for (let i = 0; i < self.parentCSS.length; i++) {\n              let pCSS = self.parentCSS[i];\n              pCSS.value = pCSS.value == null ? \"\" : (pCSS.value + \"\").trim();\n              if (pCSS.name == \"transform\") {\n                pCSS.value += \" scale(\" + self.devicePixelRatio + \")\"; //考虑设备像素比\n              }\n              if (pCSS.value != \"\") {\n                svg += pCSS.name + \" : \" + pCSS.value + \" ;\";\n              }\n            }\n\n            svg += \"transform-origin:0 0;'>\";\n            svg += html;\n            svg += \"</div>\";\n            svg += \"</foreignObject>\";\n            svg += \"</svg>\";\n\n            callback({\n              svg: svg,\n              width: self.root.width,\n              height: self.root.height,\n              fonts: self.fontList,\n              devicePixelRatio: self.devicePixelRatio,\n              distWidth: self.distWidth ? self.distWidth : self.root.width * self.devicePixelRatio, // 默认两倍图\n              distHeight: self.distHeight ? self.distHeight : self.root.height * self.devicePixelRatio,\n              imgType: self.imgType,\n              imgQuality: self.imgQuality\n            });\n          });\n        }\n      )\n      .exec();\n  };\n\n  SimpleScreenshot.prototype.toIMG = function (selector, callback) {\n    let self = this;\n    self.toSVG(selector, function (svg) {\n      if (self.puppeteerGlobalFont) {\n        if (!self.pupServerCanModifyFont) {\n          self.fontList.push({\n            name: self.puppeteerGlobalFont,\n            texts: self._wholeTexts\n          })\n        }\n        svg.globalFont = self.puppeteerGlobalFont; // 全局字体\n      }\n      self.debug && self.log(svg) // log\n      qq.request({\n        url: self.puppeteerServer,\n        method: 'post',\n        data: svg,\n        success(res) {\n          callback(res.data);\n        },\n        fail(err) {\n          self.error(err)\n        }\n      })\n    })\n  }\n\n  //元素转换为 html 代码\n  SimpleScreenshot.prototype.toHTML = function (node, isRoot) {\n    let self = this;\n    let html = \"\";\n    let inner = \"\";\n\n    //解析自身\n    let tagName = this.getNodeName(node.dataset.name);\n    let style = this.parseCSS(node, isRoot);\n\n    //伪类\n\n    //解析子元素\n    let curLevel = node.dataset.level;\n    let childLen = node.dataset.len;\n    let textChilds = [];\n    try {\n      if (node.dataset.texts != null) {\n        textChilds = JSON.parse(node.dataset.texts.replace(/'/g, '\"'));\n      }\n      /**\n       * 拼接 xml 时如果文本节点中存在条件分割符 & 应该写成 &amp; 否则会报错 EntityRef: expecting ';'\n       */\n      for (let m = 0; m < textChilds.length; m++) {\n        textChilds[m].text = textChilds[m].text.replace(/&/g, \"&amp;\");\n      }\n    } catch (err) {\n      self.log({\n        msg: `${node.dataset.texts} json parse error`,\n        err: err,\n      });\n    }\n    for (let i = 0; i < childLen; i++) {\n      let childLevel = curLevel + \"-\" + i;\n      let isText = false;\n      for (let j = 0; j < textChilds.length; j++) {\n        if (childLevel == textChilds[j].level) {\n          let fontFamily = node[\"font-family\"];\n          for (let z = 0; z < this.fontList.length; z++) {\n            let fontItem = this.fontList[z];\n            if (fontFamily.includes(fontItem.name)) {\n              for (let k = 0; k < textChilds[j].text.length; k++) {\n                //文字去重\n                if (!fontItem.texts.includes(textChilds[j].text[k])) {\n                  fontItem.texts += textChilds[j].text[k];\n                }\n              }\n            }\n          }\n          for (let k = 0; k < textChilds[j].text.length; k++) { //全部文字\n            if (!this._wholeTexts.includes(textChilds[j].text[k])) {\n              this._wholeTexts += textChilds[j].text[k];\n            }\n          }\n          inner += textChilds[j].text;\n          isText = true;\n        }\n      }\n\n      if (!isText) {\n        let child = this.getNodeByLevel(curLevel + \"-\" + i);\n        if (child) {\n          inner += this.toHTML(child, false);\n        }\n      }\n    }\n\n    //拼装\n    html += \"<\" + tagName + \" xmlns='http://www.w3.org/1999/xhtml'\";\n    if (node.dataset.src) {\n      var index = RESOURCE_NAME.indexOf(node.dataset.src);\n      if (index != -1) {\n        html += \" src='\" + RESOURCE_DATA[index] + \"'\";\n      } else {\n        html += \" src='\" + node.dataset.src + \"'\";\n      }\n    }\n    if (!isRoot) {\n      html += \" style='\" + style + \"'>\";\n    } else {\n      html += \" id='simple-screenshot'>\";\n      html += \"<style>\";\n      html +=\n        \"#simple-screenshot,#simple-screenshot *:not(style){\" +\n        style +\n        \"} \" +\n        this.globalInlineFont;\n      html += \"</style>\";\n    }\n    html += inner;\n    html += \"</\" + tagName + \">\";\n\n    return html;\n  };\n\n  //解析 css\n  SimpleScreenshot.prototype.parseCSS = function (node, isRoot) {\n    let style = \"\";\n\n    node._rules = {\n      autoRenderWidth: this.rules.autoRenderWidth,\n    };\n\n    for (let i = 0; i < this.parseCSSFilter.length; i++) {\n      //自定义 css 解析过滤器\n      let filter = this.parseCSSFilter[i];\n      if (isFunction(filter)) {\n        filter(node);\n      }\n    }\n\n    let matches = null;\n    for (let i = 0; i < COMPUTED_STYLE.length; i++) {\n      let name = COMPUTED_STYLE[i];\n      if (isRoot) {\n        //根节点\n        if (\n          [\n            \"margin-top\",\n            \"margin-left\",\n            \"margin-bottom\",\n            \"margin-right\",\n          ].includes(name)\n        ) {\n          node[name] = 0; //最外层元素的 margin 必须为 0，否则会因为偏移导致错位\n        } else if (\n          (node[\"position\"] == \"absolute\" || node[\"position\"] == \"fixed\") && [\"top\", \"bottom\", \"left\", \"right\"].includes(name)\n        ) {\n          node[name] = 0; //最外层元素为绝对定位或者固定定位时，top、bottom、left、right 必须为 0，否则会因为定位偏移导致错位\n        }\n      } else {\n        //非根节点\n        if (node[name] == this.root[name]) {\n          continue;\n        }\n      }\n\n      if (name == \"background-image\") {\n        //背景图片\n        let isReplaceResource = false;\n        URL_REGEX.lastIndex = 0; //重置正则对象\n        matches = URL_REGEX.exec(node[name]); //匹配url值\n        if (matches != null) {\n          var url = matches[1];\n          if (node[name] && url && url.search(/^(data:)/) == -1) {\n            //非dataurl\n            var index = RESOURCE_NAME.indexOf(url);\n            isReplaceResource = true;\n            if (index != -1) {\n              style += name + \": url(\" + RESOURCE_DATA[index] + \");\";\n            } else {\n              /**\n               * 拼接 xml 时如果 url 中存在条件分割符 &，应该写成 &amp; 否则会报错 EntityRef: expecting ';'\n               * 可以用 encodeURIComponent 编码来避免这个问题。\n               */\n              style += name + \": url(\" + encodeURIComponent(url) + \");\";\n            }\n          }\n        }\n        if (!isReplaceResource) {\n          style += name + \":\" + node[name] + \";\";\n        }\n      } else {\n        style += name + \":\" + node[name] + \";\";\n      }\n    }\n\n    //size\n    let realWidth = node.width;\n    let realHeight = node.height;\n\n    //微信小程序、QQ小程序中 fields size 包含 border、padding\n    let borderBottomWidth = parseFloat(node[\"border-bottom-width\"]);\n    let borderTopWidth = parseFloat(node[\"border-top-width\"]);\n    let borderLeftWidth = parseFloat(node[\"border-left-width\"]);\n    let borderRightWidth = parseFloat(node[\"border-right-width\"]);\n    borderLeftWidth = borderLeftWidth >= 0 ? borderLeftWidth : 0; // 负数 border-width 无效\n    borderRightWidth = borderRightWidth >= 0 ? borderRightWidth : 0;\n    borderTopWidth = borderTopWidth >= 0 ? borderTopWidth : 0;\n    borderBottomWidth = borderBottomWidth >= 0 ? borderBottomWidth : 0;\n    realWidth -= borderLeftWidth + borderRightWidth;\n    realHeight -= borderTopWidth + borderBottomWidth;\n\n    if (node[\"box-sizing\"] != \"border-box\") {\n      //计算非 border-box 元素 width、height\n      let paddingTop = parseFloat(node[\"padding-top\"]);\n      let paddingLeft = parseFloat(node[\"padding-left\"]);\n      let paddingBottom = parseFloat(node[\"padding-bottom\"]);\n      let paddingRight = parseFloat(node[\"padding-right\"]);\n      paddingTop = paddingTop >= 0 ? paddingTop : 0; // 负数 padding 无效\n      paddingLeft = paddingLeft >= 0 ? paddingLeft : 0;\n      paddingBottom = paddingBottom >= 0 ? paddingBottom : 0;\n      paddingRight = paddingRight >= 0 ? paddingRight : 0;\n      realWidth -= paddingLeft + paddingRight;\n      realHeight -= paddingTop + paddingBottom;\n    }\n\n    if (node._rules.autoRenderWidth && !isRoot) {\n      style += \"width: auto;\";\n    } else {\n      style += \"width:\" + realWidth + \"px;\";\n    }\n    style += \"height:\" + realHeight + \"px;\";\n\n    return style;\n  };\n\n  //根据级别获取节点\n  SimpleScreenshot.prototype.getNodeByLevel = function (level) {\n    for (let i = 0; i < this.nodes.length; i++) {\n      if (this.nodes[i].dataset.level == level) {\n        return this.nodes[i];\n      }\n    }\n    return null;\n  };\n\n  //解析 cssRules\n  SimpleScreenshot.prototype.parseCSSRules = function (finished) {\n    let count = 0;\n    let self = this;\n    self._isLoading = false;\n    let add = function () {\n      self._isLoading = true;\n      count++;\n    };\n    let del = function () {\n      count--;\n      if (count == 0) {\n        self._isLoading = true;\n        finished();\n      }\n    };\n    for (let i = 0; i < this.nodes.length; i++) {\n      let node = this.nodes[i];\n      if (\n        node.dataset.name == \"image\" &&\n        node.dataset.canvasid &&\n        (node.dataset.src == \"\" || !node.dataset.src)\n      ) {\n        //以 canvas 充当图片内容\n        (function (node) {\n          let canvasWidth = node.dataset.canvaswidth;\n          let canvasHeight = node.dataset.canvasheight;\n          let canvasId = node.dataset.canvasid;\n          add();\n          qq.canvasToTempFilePath({\n            width: canvasWidth,\n            height: canvasHeight,\n            destWidth: canvasWidth,\n            destHeight: canvasHeight,\n            canvasId: canvasId,\n            success(res) {\n              try {\n                let base64 = qq\n                  .getFileSystemManager()\n                  .readFileSync(res.tempFilePath, \"base64\");\n                node.dataset.src = \"data:image/png;base64,\" + base64;\n                del();\n              } catch (err) {\n                //可能存在内存不足报错的情况\n                self.error({\n                  msg: \"canvas to base64 error\",\n                  err: err,\n                });\n              }\n            },\n            fail(err) {\n              self.error({\n                msg: \"canvas to tempfilepath fail\",\n                err: err,\n              });\n            },\n          });\n        })(node);\n      } else {\n        if (node.src && node.src.length > 0) {\n          this.loadResource(\"url(\" + node.src + \")\", add, del);\n        }\n        if (node.dataset.src && node.dataset.src.length > 0) {\n          this.loadResource(\"url(\" + node.dataset.src + \")\", add, del);\n        }\n        let bgImg = node[\"background-image\"];\n        if (bgImg && bgImg.length > 0 && bgImg != \"none\") {\n          this.loadResource(node[\"background-image\"], add, del);\n        }\n      }\n    }\n\n    if (!self._isLoading) {\n      finished();\n    }\n  };\n\n  //加载外部资源\n  SimpleScreenshot.prototype.loadResource = function (resource, add, del) {\n    URL_REGEX.lastIndex = 0; //重置正则对象\n    let matches = URL_REGEX.exec(resource); //匹配url值\n    let self = this;\n    if (matches != null) {\n      let url = matches[1];\n      if (\n        resource &&\n        url &&\n        url.search(/^(data:)/) == -1 &&\n        !RESOURCE_NAME.includes(url)\n      ) {\n        //非 dataurl\n        let type = this.getType(url);\n        if (type != null) {\n          RESOURCE_NAME.push(url);\n          add();\n          qq.request({\n            url: url,\n            method: \"GET\",\n            responseType: \"arraybuffer\",\n            success: function (res) {\n              try {\n                let base64 = qq.arrayBufferToBase64(res.data);\n                let index = RESOURCE_NAME.indexOf(url);\n                RESOURCE_DATA[index] = \"data:\" + type + \";base64,\" + base64;\n                del();\n              } catch (err) {\n                //可能存在内存不足报错的情况\n                self.error({\n                  msg: `${url} to base64 error`,\n                  err: err,\n                });\n              }\n            },\n            fail: function (err) {\n              self.error({\n                msg: `${url} request fail`,\n                err: err,\n              });\n            },\n          });\n        }\n      }\n    }\n  };\n\n  //小程序 nodeName 和 html dom nodeName 相互转换\n  SimpleScreenshot.prototype.getNodeName = function (name) {\n    let nodeName = \"div\"; //默认 div\n    switch (name) {\n      case \"image\":\n        nodeName = \"img\";\n        break;\n      case \"view\":\n      default:\n        break;\n    }\n\n    return nodeName;\n  };\n\n  //根据 url 获取 data 名称\n  SimpleScreenshot.prototype.getType = function (url) {\n    let types = [\".png\", \".jpg\", \".jpeg\"];\n    let names = [\"image/png\", \"image/jpg\", \"image/jpg\"];\n    for (let i = 0; i < types.length; i++) {\n      if (url.lastIndexOf(types[i]) + types[i].length == url.length) {\n        return names[i];\n      }\n    }\n    return names[0];\n  };\n\n  //清空资源缓存\n  SimpleScreenshot.prototype.clearResourceCache = function () {\n    RESOURCE_NAME = [];\n    RESOURCE_DATA = [];\n  };\n\n  return SimpleScreenshot;\n});"],"sourceRoot":""}