{"version":3,"sources":["webpack://SimpleScreenshot/webpack/universalModuleDefinition","webpack://SimpleScreenshot/webpack/bootstrap","webpack://SimpleScreenshot/./index-wechat.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","URL_REGEX","RESOURCE_NAME","RESOURCE_DATA","COMPUTED_STYLE","SimpleScreenshot","params","this","devicePixelRatio","error","log","console","puppeteerServer","puppeteerGlobalFont","pupServerCanModifyFont","imgType","imgQuality","parseInt","distWidth","distHeight","debug","textDecode","text","supportForeignObject","forceScreenshotType","_isLoading","_wholeTexts","fontList","length","push","texts","globalInlineFont","preLoadResource","data","parentCSS","parseCSSFilter","rules","autoRenderWidth","toSVG","selector","callback","self","wx","createSelectorQuery","selectAll","fields","dataset","size","computedStyle","nodes","parseCSSRules","getNodeByLevel","width","parseFloat","height","html","toHTML","svg","display","pCSS","trim","fonts","exec","toIMG","globalFont","request","url","method","res","canvas","base64","err","node","isRoot","inner","tagName","getNodeName","style","parseCSS","curLevel","level","childLen","len","textChilds","JSON","parse","replace","msg","childLevel","isText","j","fontFamily","z","fontItem","includes","k","child","src","index","indexOf","_rules","filter","obj","toString","matches","isReplaceResource","lastIndex","search","encodeURIComponent","realWidth","realHeight","borderBottomWidth","borderTopWidth","borderLeftWidth","borderRightWidth","paddingTop","paddingLeft","paddingBottom","paddingRight","finished","count","add","del","canvasid","loadResource","bgImg","canvasWidth","canvaswidth","canvasHeight","canvasheight","canvasId","canvasToTempFilePath","destWidth","destHeight","qq","getFileSystemManager","readFileSync","tempFilePath","resource","type","getType","responseType","success","arrayBufferToBase64","fail","nodeName","types","names","lastIndexOf","clearResourceCache"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAA0B,iBAAID,IAE9BD,EAAuB,iBAAIC,IAR7B,CASGK,QAAQ,WACX,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUP,QAGnC,IAAIC,EAASI,EAAiBE,GAAY,CACzCC,EAAGD,EACHE,GAAG,EACHT,QAAS,IAUV,OANAU,EAAQH,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOQ,GAAI,EAGJR,EAAOD,QA0Df,OArDAM,EAAoBM,EAAIF,EAGxBJ,EAAoBO,EAAIR,EAGxBC,EAAoBQ,EAAI,SAASd,EAASe,EAAMC,GAC3CV,EAAoBW,EAAEjB,EAASe,IAClCG,OAAOC,eAAenB,EAASe,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEV,EAAoBgB,EAAI,SAAStB,GACX,oBAAXuB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAenB,EAASuB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAenB,EAAS,aAAc,CAAEyB,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBQ,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAShC,GAChC,IAAIe,EAASf,GAAUA,EAAO2B,WAC7B,WAAwB,OAAO3B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAK,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG7B,EAAoBgC,EAAI,GAIjBhC,EAAoBA,EAAoBiC,EAAI,G,oBClFrD,UAII,EAAO,QAAW,0BAAP,EAQZ,WAOD,IAAIC,EAAY,8BACZC,EAAgB,GAChBC,EAAgB,GAUpB,MAAMC,EAAiB,CAIrB,wBACA,wBACA,kBACA,0BACA,mBACA,mBACA,oBACA,sBACA,oBACA,kBACA,sBACA,4BACA,6BACA,sBACA,sBACA,kBACA,sBACA,sBACA,qBACA,sBACA,qBACA,oBACA,oBACA,oBACA,qBACA,qBACA,qBACA,mBACA,yBACA,0BACA,mBACA,mBACA,SACA,aACA,aACA,cACA,eACA,eACA,eACA,QACA,OACA,QACA,UACA,SACA,YACA,UACA,cACA,QACA,cACA,eACA,sBACA,YACA,eACA,aACA,eACA,yBACA,oBACA,uBACA,0BACA,cACA,kBACA,YACA,gBACA,eACA,OACA,iBACA,cACA,mBACA,sBACA,kBACA,gBACA,cACA,eACA,aACA,aACA,YACA,aACA,YACA,iBACA,aACA,kBACA,kBACA,cACA,gBACA,UACA,UACA,gBACA,iBACA,gBACA,gBACA,kBACA,gBACA,aACA,aACA,iBACA,eACA,gBACA,cACA,iBACA,WACA,SACA,QACA,kBACA,QACA,eACA,WACA,aACA,kBACA,kBACA,uBACA,wBACA,wBACA,2BACA,0BACA,cACA,iBACA,cACA,mBACA,gBACA,iBACA,MACA,eACA,eACA,iBACA,aACA,cACA,SACA,cACA,aACA,eACA,UACA,OACA,qBACA,sBACA,oCACA,uBACA,kCACA,oBACA,+BACA,wBACA,mBACA,4BACA,qBACA,mBACA,sBACA,eACA,aACA,oBACA,oBACA,oBACA,cACA,eACA,kBACA,gBACA,cACA,aACA,aACA,YACA,cACA,iBACA,YACA,kBACA,yBACA,oBACA,iBACA,iBACA,kBACA,oBACA,sBACA,wBACA,qBACA,eACA,iBACA,UACA,oBACA,UACA,8BACA,qBACA,qBACA,iBACA,iCACA,gCACA,yBACA,gCACA,gCACA,+BACA,gCACA,+BACA,oBACA,yBACA,qBACA,sBACA,wBACA,sBACA,oBACA,QACA,cACA,qBACA,6BACA,uBACA,gBACA,wBACA,eACA,8BACA,uBACA,qCACA,8BACA,iCACA,8BACA,0BACA,2BACA,wBACA,4BACA,4BACA,YACA,mBACA,kBACA,oBACA,sBACA,cACA,uBACA,qBACA,qBACA,YACA,YACA,OACA,SACA,cACA,gBACA,iBACA,aACA,eACA,sBACA,8BACA,kBACA,OACA,eACA,YACA,aACA,aACA,eACA,YACA,kBACA,SACA,mBACA,oBACA,iBACA,kBACA,oBACA,iBACA,eACA,qBACA,iBACA,oBACA,cACA,eACA,gBACA,cACA,IACA,KACA,KACA,IACA,IACA,IACA,KACA,KACA,cACA,cAGF,SAASC,EAAiBC,GACxBC,KAAKC,iBAAmBF,EAAOE,kBAAoB,EACnDD,KAAKE,MAAQH,EAAOG,OAAS,aAC7BF,KAAKG,IAAMJ,EAAOI,KAAOC,QAAQD,IACjCH,KAAKK,gBAAkBN,EAAOM,gBAC9BL,KAAKM,oBAAsBP,EAAOO,oBAClCN,KAAKO,wBAAyBR,EAAOQ,wBAAyBR,EAAOQ,uBACrEP,KAAKQ,QAAUT,EAAOS,SAAW,OACjCR,KAAKS,WAAaC,SAASX,EAAOU,aAAe,GACjDT,KAAKW,UAAYZ,EAAOY,UACxBX,KAAKY,WAAab,EAAOa,WACzBZ,KAAKa,QAASd,EAAOc,MACrBb,KAAKc,WAAaf,EAAOe,WAAaf,EAAOe,WAAa,SAAUC,GAClE,OAAOA,GAITf,KAAKgB,sBAAuB,EAC5BhB,KAAKiB,oBAAsB,SAE3BjB,KAAKkB,YAAa,EAClBlB,KAAKmB,YAAc,GAGnBnB,KAAKoB,SAAW,GAChB,IAAIA,EAAWrB,EAAOqB,UAAY,GAClC,IAAK,IAAI1D,EAAI,EAAGA,EAAI0D,EAASC,OAAQ3D,IACnCsC,KAAKoB,SAAS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","file":"index-wechat.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"simplescreenshot\"] = factory();\n\telse\n\t\troot[\"SimpleScreenshot\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","/* global define module wx */\n(function (factory) {\n  if (typeof define === \"function\" && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof module === \"object\" && module.exports) {\n    // Node/CommonJS\n    module.exports = factory();\n  } else {\n    // Browser globals\n    window.SimpleScreenshot = factory();\n  }\n})(function () {\n  /**\n   * 小程序目前无法处理以下情况：\n   * 1、after、before 等伪类元素；\n   * 2、加载项目内资源文件；\n   */\n\n  let URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n  let RESOURCE_NAME = [];\n  let RESOURCE_DATA = [];\n\n  function isFunction(obj) {\n    // 判断对象是否是function\n    return obj && {}.toString.call(obj) === \"[object Function]\";\n  }\n\n  /**\n   * window.getComputedStyle 去掉 animation、transition\n   */\n  const COMPUTED_STYLE = [\n    //使用小程序 size 属性代替 computedStyle 中的 width、height\n    //\"width\",\n    //\"height\",\n    \"background-attachment\",\n    \"background-blend-mode\",\n    \"background-clip\",\n    \"-webkit-background-clip\",\n    \"background-color\",\n    \"background-image\",\n    \"background-origin\",\n    \"background-position\",\n    \"background-repeat\",\n    \"background-size\",\n    \"border-bottom-color\",\n    \"border-bottom-left-radius\",\n    \"border-bottom-right-radius\",\n    \"border-bottom-style\",\n    \"border-bottom-width\",\n    \"border-collapse\",\n    \"border-image-outset\",\n    \"border-image-repeat\",\n    \"border-image-slice\",\n    \"border-image-source\",\n    \"border-image-width\",\n    \"border-left-color\",\n    \"border-left-style\",\n    \"border-left-width\",\n    \"border-right-color\",\n    \"border-right-style\",\n    \"border-right-width\",\n    \"border-top-color\",\n    \"border-top-left-radius\",\n    \"border-top-right-radius\",\n    \"border-top-style\",\n    \"border-top-width\",\n    \"bottom\",\n    \"box-shadow\",\n    \"box-sizing\",\n    \"break-after\",\n    \"break-before\",\n    \"break-inside\",\n    \"caption-side\",\n    \"clear\",\n    \"clip\",\n    \"color\",\n    \"content\",\n    \"cursor\",\n    \"direction\",\n    \"display\",\n    \"empty-cells\",\n    \"float\",\n    \"font-family\",\n    \"font-kerning\",\n    \"font-optical-sizing\",\n    \"font-size\",\n    \"font-stretch\",\n    \"font-style\",\n    \"font-variant\",\n    \"font-variant-ligatures\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n    \"font-weight\",\n    \"image-rendering\",\n    \"isolation\",\n    \"justify-items\",\n    \"justify-self\",\n    \"left\",\n    \"letter-spacing\",\n    \"line-height\",\n    \"list-style-image\",\n    \"list-style-position\",\n    \"list-style-type\",\n    \"margin-bottom\",\n    \"margin-left\",\n    \"margin-right\",\n    \"margin-top\",\n    \"max-height\",\n    \"max-width\",\n    \"min-height\",\n    \"min-width\",\n    \"mix-blend-mode\",\n    \"object-fit\",\n    \"object-position\",\n    \"offset-distance\",\n    \"offset-path\",\n    \"offset-rotate\",\n    \"opacity\",\n    \"orphans\",\n    \"outline-color\",\n    \"outline-offset\",\n    \"outline-style\",\n    \"outline-width\",\n    \"overflow-anchor\",\n    \"overflow-wrap\",\n    \"overflow-x\",\n    \"overflow-y\",\n    \"padding-bottom\",\n    \"padding-left\",\n    \"padding-right\",\n    \"padding-top\",\n    \"pointer-events\",\n    \"position\",\n    \"resize\",\n    \"right\",\n    \"scroll-behavior\",\n    \"speak\",\n    \"table-layout\",\n    \"tab-size\",\n    \"text-align\",\n    \"text-align-last\",\n    \"text-decoration\",\n    \"text-decoration-line\",\n    \"text-decoration-style\",\n    \"text-decoration-color\",\n    \"text-decoration-skip-ink\",\n    \"text-underline-position\",\n    \"text-indent\",\n    \"text-rendering\",\n    \"text-shadow\",\n    \"text-size-adjust\",\n    \"text-overflow\",\n    \"text-transform\",\n    \"top\",\n    \"touch-action\",\n    \"unicode-bidi\",\n    \"vertical-align\",\n    \"visibility\",\n    \"white-space\",\n    \"widows\",\n    \"will-change\",\n    \"word-break\",\n    \"word-spacing\",\n    \"z-index\",\n    \"zoom\",\n    \"-webkit-appearance\",\n    \"backface-visibility\",\n    \"-webkit-border-horizontal-spacing\",\n    \"-webkit-border-image\",\n    \"-webkit-border-vertical-spacing\",\n    \"-webkit-box-align\",\n    \"-webkit-box-decoration-break\",\n    \"-webkit-box-direction\",\n    \"-webkit-box-flex\",\n    \"-webkit-box-ordinal-group\",\n    \"-webkit-box-orient\",\n    \"-webkit-box-pack\",\n    \"-webkit-box-reflect\",\n    \"column-count\",\n    \"column-gap\",\n    \"column-rule-color\",\n    \"column-rule-style\",\n    \"column-rule-width\",\n    \"column-span\",\n    \"column-width\",\n    \"backdrop-filter\",\n    \"align-content\",\n    \"align-items\",\n    \"align-self\",\n    \"flex-basis\",\n    \"flex-grow\",\n    \"flex-shrink\",\n    \"flex-direction\",\n    \"flex-wrap\",\n    \"justify-content\",\n    \"-webkit-font-smoothing\",\n    \"grid-auto-columns\",\n    \"grid-auto-flow\",\n    \"grid-auto-rows\",\n    \"grid-column-end\",\n    \"grid-column-start\",\n    \"grid-template-areas\",\n    \"grid-template-columns\",\n    \"grid-template-rows\",\n    \"grid-row-end\",\n    \"grid-row-start\",\n    \"row-gap\",\n    \"-webkit-highlight\",\n    \"hyphens\",\n    \"-webkit-hyphenate-character\",\n    \"-webkit-line-break\",\n    \"-webkit-line-clamp\",\n    \"-webkit-locale\",\n    \"-webkit-margin-before-collapse\",\n    \"-webkit-margin-after-collapse\",\n    \"-webkit-mask-box-image\",\n    \"-webkit-mask-box-image-outset\",\n    \"-webkit-mask-box-image-repeat\",\n    \"-webkit-mask-box-image-slice\",\n    \"-webkit-mask-box-image-source\",\n    \"-webkit-mask-box-image-width\",\n    \"-webkit-mask-clip\",\n    \"-webkit-mask-composite\",\n    \"-webkit-mask-image\",\n    \"-webkit-mask-origin\",\n    \"-webkit-mask-position\",\n    \"-webkit-mask-repeat\",\n    \"-webkit-mask-size\",\n    \"order\",\n    \"perspective\",\n    \"perspective-origin\",\n    \"-webkit-print-color-adjust\",\n    \"-webkit-rtl-ordering\",\n    \"shape-outside\",\n    \"shape-image-threshold\",\n    \"shape-margin\",\n    \"-webkit-tap-highlight-color\",\n    \"-webkit-text-combine\",\n    \"-webkit-text-decorations-in-effect\",\n    \"-webkit-text-emphasis-color\",\n    \"-webkit-text-emphasis-position\",\n    \"-webkit-text-emphasis-style\",\n    \"-webkit-text-fill-color\",\n    \"-webkit-text-orientation\",\n    \"-webkit-text-security\",\n    \"-webkit-text-stroke-color\",\n    \"-webkit-text-stroke-width\",\n    \"transform\",\n    \"transform-origin\",\n    \"transform-style\",\n    \"-webkit-user-drag\",\n    \"-webkit-user-modify\",\n    \"user-select\",\n    \"-webkit-writing-mode\",\n    \"-webkit-app-region\",\n    \"buffered-rendering\",\n    \"clip-path\",\n    \"clip-rule\",\n    \"mask\",\n    \"filter\",\n    \"flood-color\",\n    \"flood-opacity\",\n    \"lighting-color\",\n    \"stop-color\",\n    \"stop-opacity\",\n    \"color-interpolation\",\n    \"color-interpolation-filters\",\n    \"color-rendering\",\n    \"fill\",\n    \"fill-opacity\",\n    \"fill-rule\",\n    \"marker-end\",\n    \"marker-mid\",\n    \"marker-start\",\n    \"mask-type\",\n    \"shape-rendering\",\n    \"stroke\",\n    \"stroke-dasharray\",\n    \"stroke-dashoffset\",\n    \"stroke-linecap\",\n    \"stroke-linejoin\",\n    \"stroke-miterlimit\",\n    \"stroke-opacity\",\n    \"stroke-width\",\n    \"alignment-baseline\",\n    \"baseline-shift\",\n    \"dominant-baseline\",\n    \"text-anchor\",\n    \"writing-mode\",\n    \"vector-effect\",\n    \"paint-order\",\n    \"d\",\n    \"cx\",\n    \"cy\",\n    \"x\",\n    \"y\",\n    \"r\",\n    \"rx\",\n    \"ry\",\n    \"caret-color\",\n    \"line-break\",\n  ];\n\n  function SimpleScreenshot(params) {\n    this.devicePixelRatio = params.devicePixelRatio || 1;\n    this.error = params.error || function () {};\n    this.log = params.log || console.log;\n    this.puppeteerServer = params.puppeteerServer; // puppeteer 截屏服务\n    this.puppeteerGlobalFont = params.puppeteerGlobalFont; // puppeteer 截屏服务全局字体\n    this.pupServerCanModifyFont = params.pupServerCanModifyFont ? params.pupServerCanModifyFont : true; // puppeteer 截屏服务是否支持配置字体\n    this.imgType = params.imgType || 'jpeg'; //图片类型\n    this.imgQuality = parseInt(params.imgQuality) || 80; //图片质量\n    this.distWidth = params.distWidth; //目标尺寸\n    this.distHeight = params.distHeight;\n    this.debug = !params.debug ? false : true; // 调试模式\n    this.textDecode = params.textDecode ? params.textDecode : function (text) {\n      return text;\n    }\n\n    //小程序目前并不支持客户端渲染 svg foreignobject\n    this.supportForeignObject = false;\n    this.forceScreenshotType = 'server';\n\n    this._isLoading = false; // 是否正在加载资源\n    this._wholeTexts = \"\"; // 全部文字\n\n    //字体列表\n    this.fontList = [];\n    let fontList = params.fontList || [];\n    for (let i = 0; i < fontList.length; i++) {\n      this.fontList.push({\n        name: fontList[i],\n        texts: \"\",\n      });\n    }\n\n    this.globalInlineFont = params.globalInlineFont || \"\";\n\n    //预加载资源\n    this.preLoadResource = params.preLoadResource || [];\n    for (let i = 0; i < this.preLoadResource.length; i++) {\n      let name = this.preLoadResource[i].name;\n      let data = this.preLoadResource[i].data;\n      if (data && data != \"\") {\n        RESOURCE_NAME.push(name);\n        RESOURCE_DATA.push(data);\n      }\n    }\n\n    /**\n     * 父元素的部分属性对子元素有影响，但是并不会被子元素继承，比如：opacity、transform、filter；\n     * 但是小程序中没办法获取父节点元素，目前的解决办法是手动计算，然后通过参数传递。\n     */\n    this.parentCSS = params.parentCSS || [{\n        name: \"opacity\",\n        value: 1,\n      },\n      {\n        name: \"transform\", // 因为是给子元素截图，父元素的 transform-origin 等属性可以不考虑\n        value: \"\",\n      },\n      {\n        name: \"filter\",\n        value: \"\",\n      },\n    ];\n\n    //自定义 css 解析过滤器\n    this.parseCSSFilter = params.parseCSSFilter || [];\n\n    /**\n     * 特殊规则\n     * autoRenderWidth 自适应渲染宽度，在小程序中因为字体原因，某些文字元素 fields size 并不精确，导致文字超出容器，从而溢出换行。\n     */\n    this.rules = {\n      autoRenderWidth: false,\n    };\n  }\n\n  SimpleScreenshot.prototype.toSVG = function (selector, callback) {\n    let self = this;\n    self._wholeTexts = \"\";\n    wx.createSelectorQuery()\n      .selectAll(selector)\n      .fields({\n          dataset: true,\n          size: true,\n          computedStyle: COMPUTED_STYLE,\n        },\n        function (nodes) {\n          self.nodes = nodes;\n          self.parseCSSRules(function () {\n            self.root = self.getNodeByLevel(\"0\");\n            let width = parseFloat(self.root.width) * self.devicePixelRatio;\n            let height = parseFloat(self.root.height) * self.devicePixelRatio;\n            let html = self.toHTML(self.root, true);\n\n            let svg = \"\";\n            svg += \"<svg xmlns='http://www.w3.org/2000/svg'\";\n            svg += \" width='\" + width + \"'\";\n            svg += \" height='\" + height + \"'\";\n            svg += \">\";\n            svg += \"<foreignObject width='100%' height='100%'>\";\n            svg += \"<div xmlns='http://www.w3.org/1999/xhtml' style='\";\n            if (self.root.display == \"inline-block\") {\n              // 防止行内元素的布局被空白字符挤乱\n              svg += \"font-size : 0 ;\";\n            }\n\n            for (let i = 0; i < self.parentCSS.length; i++) {\n              let pCSS = self.parentCSS[i];\n              pCSS.value = pCSS.value == null ? \"\" : (pCSS.value + \"\").trim();\n              if (pCSS.name == \"transform\") {\n                pCSS.value += \" scale(\" + self.devicePixelRatio + \")\"; //考虑设备像素比\n              }\n              if (pCSS.value != \"\") {\n                svg += pCSS.name + \" : \" + pCSS.value + \" ;\";\n              }\n            }\n\n            svg += \"transform-origin:0 0;'>\";\n            svg += html;\n            svg += \"</div>\";\n            svg += \"</foreignObject>\";\n            svg += \"</svg>\";\n\n            callback({\n              svg: svg,\n              width: self.root.width,\n              height: self.root.height,\n              fonts: self.fontList,\n              devicePixelRatio: self.devicePixelRatio,\n              distWidth: self.distWidth ? self.distWidth : self.root.width * self.devicePixelRatio, // 默认两倍图\n              distHeight: self.distHeight ? self.distHeight : self.root.height * self.devicePixelRatio,\n              imgType: self.imgType,\n              imgQuality: self.imgQuality\n            });\n          });\n        }\n      )\n      .exec();\n  };\n\n  SimpleScreenshot.prototype.toIMG = function (selector, callback) {\n    let self = this;\n    self.toSVG(selector, function (svg) {\n      if (self.puppeteerGlobalFont) {\n        if (!self.pupServerCanModifyFont) {\n          self.fontList.push({\n            name: self.puppeteerGlobalFont,\n            texts: self._wholeTexts\n          })\n        }\n        svg.globalFont = self.puppeteerGlobalFont; // 全局字体\n      }\n      self.debug && self.log(svg) // log\n      wx.request({\n        url: self.puppeteerServer,\n        method: 'post',\n        data: svg,\n        success(res) {\n          callback({\n            canvas: null,\n            base64: res.data\n          });\n        },\n        fail(err) {\n          self.error(err)\n        }\n      })\n    })\n  }\n\n  //元素转换为 html 代码\n  SimpleScreenshot.prototype.toHTML = function (node, isRoot) {\n    let self = this;\n    let html = \"\";\n    let inner = \"\";\n\n    //解析自身\n    let tagName = this.getNodeName(node.dataset.name);\n    let style = this.parseCSS(node, isRoot);\n\n    //伪类\n\n    //解析子元素\n    let curLevel = node.dataset.level;\n    let childLen = node.dataset.len;\n    let textChilds = [];\n    try {\n      if (node.dataset.texts != null) {\n        textChilds = JSON.parse(node.dataset.texts.replace(/'/g, '\"'));\n      }\n      /**\n       * 拼接 xml 时如果文本节点中存在条件分割符 & 应该写成 &amp; 否则会报错 EntityRef: expecting ';'\n       */\n      for (let m = 0; m < textChilds.length; m++) {\n        textChilds[m].text = this.textDecode(textChilds[m].text).replace(/&/g, \"&amp;\");\n      }\n    } catch (err) {\n      self.debug && self.log({\n        msg: `${node.dataset.texts} json parse error`,\n        err: err,\n      });\n    }\n    for (let i = 0; i < childLen; i++) {\n      let childLevel = curLevel + \"-\" + i;\n      let isText = false;\n      for (let j = 0; j < textChilds.length; j++) {\n        if (childLevel == textChilds[j].level) {\n          let fontFamily = node[\"font-family\"];\n          for (let z = 0; z < this.fontList.length; z++) {\n            let fontItem = this.fontList[z];\n            if (fontFamily.includes(fontItem.name)) {\n              for (let k = 0; k < textChilds[j].text.length; k++) {\n                //文字去重\n                if (!fontItem.texts.includes(textChilds[j].text[k])) {\n                  fontItem.texts += textChilds[j].text[k];\n                }\n              }\n            }\n          }\n          for (let k = 0; k < textChilds[j].text.length; k++) { //全部文字\n            if (!this._wholeTexts.includes(textChilds[j].text[k])) {\n              this._wholeTexts += textChilds[j].text[k];\n            }\n          }\n          inner += textChilds[j].text;\n          isText = true;\n        }\n      }\n\n      if (!isText) {\n        let child = this.getNodeByLevel(curLevel + \"-\" + i);\n        if (child) {\n          inner += this.toHTML(child, false);\n        }\n      }\n    }\n\n    //拼装\n    html += \"<\" + tagName + \" xmlns='http://www.w3.org/1999/xhtml'\";\n    if (node.dataset.src) {\n      var index = RESOURCE_NAME.indexOf(node.dataset.src);\n      if (index != -1) {\n        html += \" src='\" + RESOURCE_DATA[index] + \"'\";\n      } else {\n        html += \" src='\" + node.dataset.src + \"'\";\n      }\n    }\n    if (!isRoot) {\n      html += \" style='\" + style + \"'>\";\n    } else {\n      html += \" id='simple-screenshot'>\";\n      html += \"<style>\";\n      html +=\n        \"#simple-screenshot,#simple-screenshot *:not(style){\" +\n        style +\n        \"} \" +\n        this.globalInlineFont;\n      html += \"</style>\";\n    }\n    html += inner;\n    html += \"</\" + tagName + \">\";\n\n    return html;\n  };\n\n  //解析 css\n  SimpleScreenshot.prototype.parseCSS = function (node, isRoot) {\n    let style = \"\";\n\n    node._rules = {\n      autoRenderWidth: this.rules.autoRenderWidth,\n    };\n\n    for (let i = 0; i < this.parseCSSFilter.length; i++) {\n      //自定义 css 解析过滤器\n      let filter = this.parseCSSFilter[i];\n      if (isFunction(filter)) {\n        filter(node);\n      }\n    }\n\n    let matches = null;\n    for (let i = 0; i < COMPUTED_STYLE.length; i++) {\n      let name = COMPUTED_STYLE[i];\n      if (isRoot) {\n        //根节点\n        if (\n          [\n            \"margin-top\",\n            \"margin-left\",\n            \"margin-bottom\",\n            \"margin-right\",\n          ].includes(name)\n        ) {\n          node[name] = 0; //最外层元素的 margin 必须为 0，否则会因为偏移导致错位\n        } else if (\n          (node[\"position\"] == \"absolute\" || node[\"position\"] == \"fixed\") && [\"top\", \"bottom\", \"left\", \"right\"].includes(name)\n        ) {\n          node[name] = 0; //最外层元素为绝对定位或者固定定位时，top、bottom、left、right 必须为 0，否则会因为定位偏移导致错位\n        }\n      } else {\n        //非根节点\n        if (node[name] == this.root[name]) {\n          continue;\n        }\n      }\n\n      if (name == \"background-image\") {\n        //背景图片\n        let isReplaceResource = false;\n        URL_REGEX.lastIndex = 0; //重置正则对象\n        matches = URL_REGEX.exec(node[name]); //匹配url值\n        if (matches != null) {\n          var url = matches[1];\n          if (node[name] && url && url.search(/^(data:)/) == -1) {\n            //非dataurl\n            var index = RESOURCE_NAME.indexOf(url);\n            isReplaceResource = true;\n            if (index != -1) {\n              style += name + \": url(\" + RESOURCE_DATA[index] + \");\";\n            } else {\n              /**\n               * 拼接 xml 时如果 url 中存在条件分割符 &，应该写成 &amp; 否则会报错 EntityRef: expecting ';'\n               * 可以用 encodeURIComponent 编码来避免这个问题。\n               */\n              style += name + \": url(\" + encodeURIComponent(url) + \");\";\n            }\n          }\n        }\n        if (!isReplaceResource) {\n          style += name + \":\" + node[name] + \";\";\n        }\n      } else {\n        style += name + \":\" + node[name] + \";\";\n      }\n    }\n\n    //size\n    let realWidth = node.width;\n    let realHeight = node.height;\n\n    //微信小程序、QQ小程序中 fields size 包含 border、padding\n    let borderBottomWidth = parseFloat(node[\"border-bottom-width\"]);\n    let borderTopWidth = parseFloat(node[\"border-top-width\"]);\n    let borderLeftWidth = parseFloat(node[\"border-left-width\"]);\n    let borderRightWidth = parseFloat(node[\"border-right-width\"]);\n    borderLeftWidth = borderLeftWidth >= 0 ? borderLeftWidth : 0; // 负数 border-width 无效\n    borderRightWidth = borderRightWidth >= 0 ? borderRightWidth : 0;\n    borderTopWidth = borderTopWidth >= 0 ? borderTopWidth : 0;\n    borderBottomWidth = borderBottomWidth >= 0 ? borderBottomWidth : 0;\n    realWidth -= borderLeftWidth + borderRightWidth;\n    realHeight -= borderTopWidth + borderBottomWidth;\n\n    if (node[\"box-sizing\"] != \"border-box\") {\n      //计算非 border-box 元素 width、height\n      let paddingTop = parseFloat(node[\"padding-top\"]);\n      let paddingLeft = parseFloat(node[\"padding-left\"]);\n      let paddingBottom = parseFloat(node[\"padding-bottom\"]);\n      let paddingRight = parseFloat(node[\"padding-right\"]);\n      paddingTop = paddingTop >= 0 ? paddingTop : 0; // 负数 padding 无效\n      paddingLeft = paddingLeft >= 0 ? paddingLeft : 0;\n      paddingBottom = paddingBottom >= 0 ? paddingBottom : 0;\n      paddingRight = paddingRight >= 0 ? paddingRight : 0;\n      realWidth -= paddingLeft + paddingRight;\n      realHeight -= paddingTop + paddingBottom;\n    }\n\n    if (node._rules.autoRenderWidth && !isRoot) {\n      style += \"width: auto;\";\n    } else {\n      style += \"width:\" + realWidth + \"px;\";\n    }\n    style += \"height:\" + realHeight + \"px;\";\n\n    return style;\n  };\n\n  //根据级别获取节点\n  SimpleScreenshot.prototype.getNodeByLevel = function (level) {\n    for (let i = 0; i < this.nodes.length; i++) {\n      if (this.nodes[i].dataset.level == level) {\n        return this.nodes[i];\n      }\n    }\n    return null;\n  };\n\n  //解析 cssRules\n  SimpleScreenshot.prototype.parseCSSRules = function (finished) {\n    let count = 0;\n    let self = this;\n    self._isLoading = false;\n    let add = function () {\n      self._isLoading = true;\n      count++;\n    };\n    let del = function () {\n      count--;\n      if (count == 0) {\n        self._isLoading = true;\n        finished();\n      }\n    };\n    for (let i = 0; i < this.nodes.length; i++) {\n      let node = this.nodes[i];\n      if (\n        node.dataset.name == \"image\" &&\n        node.dataset.canvasid &&\n        (node.dataset.src == \"\" || !node.dataset.src)\n      ) {\n        //以 canvas 充当图片内容\n        (function (node) {\n          let canvasWidth = node.dataset.canvaswidth;\n          let canvasHeight = node.dataset.canvasheight;\n          let canvasId = node.dataset.canvasid;\n          add();\n          wx.canvasToTempFilePath({\n            width: canvasWidth,\n            height: canvasHeight,\n            destWidth: canvasWidth,\n            destHeight: canvasHeight,\n            canvasId: canvasId,\n            success(res) {\n              try {\n                let base64 = qq\n                  .getFileSystemManager()\n                  .readFileSync(res.tempFilePath, \"base64\");\n                node.dataset.src = \"data:image/png;base64,\" + base64;\n                del();\n              } catch (err) {\n                //可能存在内存不足报错的情况\n                self.error({\n                  msg: \"canvas to base64 error\",\n                  err: err,\n                });\n              }\n            },\n            fail(err) {\n              self.error({\n                msg: \"canvas to tempfilepath fail\",\n                err: err,\n              });\n            },\n          });\n        })(node);\n      } else {\n        if (node.src && node.src.length > 0) {\n          this.loadResource(\"url(\" + node.src + \")\", add, del);\n        }\n        if (node.dataset.src && node.dataset.src.length > 0) {\n          this.loadResource(\"url(\" + node.dataset.src + \")\", add, del);\n        }\n        let bgImg = node[\"background-image\"];\n        if (bgImg && bgImg.length > 0 && bgImg != \"none\") {\n          this.loadResource(node[\"background-image\"], add, del);\n        }\n      }\n    }\n\n    if (!self._isLoading) {\n      finished();\n    }\n  };\n\n  //加载外部资源\n  SimpleScreenshot.prototype.loadResource = function (resource, add, del) {\n    URL_REGEX.lastIndex = 0; //重置正则对象\n    let matches = URL_REGEX.exec(resource); //匹配url值\n    let self = this;\n    if (matches != null) {\n      let url = matches[1];\n      if (\n        resource &&\n        url &&\n        url.search(/^(data:)/) == -1 &&\n        !RESOURCE_NAME.includes(url)\n      ) {\n        //非 dataurl\n        let type = this.getType(url);\n        if (type != null) {\n          RESOURCE_NAME.push(url);\n          add();\n          wx.request({\n            url: url,\n            method: \"GET\",\n            responseType: \"arraybuffer\",\n            success: function (res) {\n              try {\n                let base64 = wx.arrayBufferToBase64(res.data);\n                let index = RESOURCE_NAME.indexOf(url);\n                RESOURCE_DATA[index] = \"data:\" + type + \";base64,\" + base64;\n                del();\n              } catch (err) {\n                //可能存在内存不足报错的情况\n                self.error({\n                  msg: `${url} to base64 error`,\n                  err: err,\n                });\n              }\n            },\n            fail: function (err) {\n              self.error({\n                msg: `${url} request fail`,\n                err: err,\n              });\n            },\n          });\n        }\n      }\n    }\n  };\n\n  //小程序 nodeName 和 html dom nodeName 相互转换\n  SimpleScreenshot.prototype.getNodeName = function (name) {\n    let nodeName = \"div\"; //默认 div\n    switch (name) {\n      case \"image\":\n        nodeName = \"img\";\n        break;\n      case \"view\":\n      default:\n        break;\n    }\n\n    return nodeName;\n  };\n\n  //根据 url 获取 data 名称\n  SimpleScreenshot.prototype.getType = function (url) {\n    let types = [\".png\", \".jpg\", \".jpeg\"];\n    let names = [\"image/png\", \"image/jpg\", \"image/jpg\"];\n    for (let i = 0; i < types.length; i++) {\n      if (url.lastIndexOf(types[i]) + types[i].length == url.length) {\n        return names[i];\n      }\n    }\n    return names[0];\n  };\n\n  //清空资源缓存\n  SimpleScreenshot.prototype.clearResourceCache = function () {\n    RESOURCE_NAME = [];\n    RESOURCE_DATA = [];\n  };\n\n  return SimpleScreenshot;\n});"],"sourceRoot":""}